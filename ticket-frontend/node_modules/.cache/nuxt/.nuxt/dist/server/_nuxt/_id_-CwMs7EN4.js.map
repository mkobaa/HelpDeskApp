{"version":3,"file":"_id_-CwMs7EN4.js","sources":["../../../../../../../app/components/survey/Ratings.vue","../../../../../../../app/components/survey/Comments.vue","../../../../../../../app/components/survey/SubmitButtons.vue","../../../../../../../app/components/survey/SuccessBanner.vue","../../../../../../../app/components/survey/SurveyForm.vue","../../../../../../../app/pages/user/survey/[id].vue"],"sourcesContent":["<script setup lang=\"ts\">\r\nconst props = defineProps({ label: { type: String, default: '' }, modelValue: { type: Number, default: 5 } })\r\nconst emit = defineEmits(['update:modelValue'])\r\n\r\nconst labels = ['Poor','Fair','Good','Very Good','Excellent']\r\n\r\nconst set = (n: number) => emit('update:modelValue', n)\r\n</script>\r\n\r\n<template>\r\n  <div>\r\n    <p class=\"text-sm font-semibold text-gray-700 mb-1\">{{ label }}</p>\r\n    <div class=\"flex gap-3\">\r\n      <button\r\n        v-for=\"n in 5\"\r\n        :key=\"n\"\r\n        type=\"button\"\r\n        @click=\"set(n)\"\r\n        :aria-pressed=\"modelValue===n\"\r\n        :class=\"[\r\n          'w-24 h-12 flex flex-col items-center justify-center rounded-md text-sm font-medium transition-colors',\r\n          modelValue===n ? 'border border-sky-600 bg-sky-50 text-sky-700' : 'border border-transparent bg-white text-gray-800 hover:border-gray-200'\r\n        ]\"\r\n      >\r\n        <span class=\"text-lg font-semibold\">{{ n }}</span>\r\n        <span class=\"text-xs text-muted-500\">{{ labels[n-1] }}</span>\r\n      </button>\r\n    </div>\r\n  </div>\r\n</template>\r\n","<script setup lang=\"ts\">\r\nconst props = defineProps({ modelValue: { type: String, default: '' }, maxLength: { type: Number, default: 1000 } })\r\nconst emit = defineEmits(['update:modelValue'])\r\n\r\nconst onInput = (e) => {\r\n  const val = String(e.target.value).slice(0, props.maxLength)\r\n  emit('update:modelValue', val)\r\n}\r\n</script>\r\n\r\n<template>\r\n  <div>\r\n    <label class=\"text-sm font-semibold text-gray-700\">Comments (optional)</label>\r\n    <textarea :value=\"modelValue\" @input=\"onInput\" :rows=\"4\" class=\"form-textarea w-full mt-1\" placeholder=\"Anything else you'd like to tell us?\"></textarea>\r\n    <div class=\"text-xs text-muted-500 mt-1\">Optional — helpful for context (max {{ maxLength }} chars).</div>\r\n  </div>\r\n</template>\r\n","<script setup lang=\"ts\">\r\nconst props = defineProps({ loading: { type: Boolean, default: false } })\r\nconst emit = defineEmits(['submit','cancel'])\r\n</script>\r\n\r\n<template>\r\n  <div class=\"flex items-center gap-3\">\r\n    <UButton :loading=\"loading\" color=\"primary\" @click.prevent=\"$emit('submit')\">Submit feedback</UButton>\r\n    <UButton color=\"neutral\" variant=\"outline\" @click.prevent=\"$emit('cancel')\">Cancel</UButton>\r\n  </div>\r\n</template>\r\n","<script setup lang=\"ts\">\r\nconst props = defineProps({ message: { type: String, default: '' } })\r\n</script>\r\n\r\n<template>\r\n  <div v-if=\"message\" class=\"my-2\">\r\n    <UBadge color=\"emerald\" variant=\"soft\">{{ message }}</UBadge>\r\n  </div>\r\n</template>\r\n","<script setup lang=\"ts\">\r\nimport { ref, computed, onMounted } from 'vue'\r\nimport { getTicketById } from '~/api/tickets/tickets'\r\nimport Ratings from './Ratings.vue'\r\nimport Comments from './Comments.vue'\r\nimport SubmitButtons from './SubmitButtons.vue'\r\nimport SuccessBanner from './SuccessBanner.vue'\r\n\r\nconst route = useRoute()\r\nconst router = useRouter()\r\nconst ticketIdParam = route.params.id || ''\r\n\r\nconst ticket = ref(null)\r\nconst loadingTicket = ref(false)\r\n\r\nconst fetchTicket = async () => {\r\n  if (!ticketIdParam) return\r\n  loadingTicket.value = true\r\n  try {\r\n    ticket.value = await getTicketById(ticketIdParam)\r\n  } catch (e) {\r\n    ticket.value = null\r\n  } finally {\r\n    loadingTicket.value = false\r\n  }\r\n}\r\n\r\nonMounted(fetchTicket)\r\n\r\nconst formatDate = (val) => {\r\n  if (!val) return ''\r\n  const d = new Date(val)\r\n  if (Number.isNaN(d.getTime())) return String(val)\r\n  return d.toLocaleString()\r\n}\r\n\r\nconst form = ref({\r\n  ticket_id: ticketIdParam || '',\r\n  satisfaction_rating: 5,\r\n  response_time_rating: 5,\r\n  resolution_quality_rating: 5,\r\n  comments: ''\r\n})\r\n\r\nconst errors = ref<any>({})\r\nconst submitting = ref(false)\r\nconst successMessage = ref('')\r\n\r\nconst validate = () => {\r\n  errors.value = {}\r\n  const between = (v) => Number(v) >= 1 && Number(v) <= 5\r\n  if (!between(form.value.satisfaction_rating)) errors.value.satisfaction_rating = 'Required (1-5)'\r\n  if (!between(form.value.response_time_rating)) errors.value.response_time_rating = 'Required (1-5)'\r\n  if (!between(form.value.resolution_quality_rating)) errors.value.resolution_quality_rating = 'Required (1-5)'\r\n  return Object.keys(errors.value).length === 0\r\n}\r\n\r\nconst submit = async () => {\r\n  if (!validate()) return\r\n  submitting.value = true\r\n  try {\r\n    const token = useCookie('auth_token')\r\n    let bearer = token.value || ''\r\n    try { bearer = decodeURIComponent(bearer) } catch {}\r\n\r\n    const payload = {\r\n      satisfaction_rating: Number(form.value.satisfaction_rating),\r\n      response_time_rating: Number(form.value.response_time_rating),\r\n      resolution_quality_rating: Number(form.value.resolution_quality_rating),\r\n      comments: form.value.comments\r\n    }\r\n\r\n    const ticketId = ticket.value?.id || form.value.ticket_id || ticketIdParam\r\n    const url = `http://localhost:8000/api/tickets/${encodeURIComponent(ticketId)}/survey`\r\n    const res = await fetch(url, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        Authorization: `Bearer ${bearer}`\r\n      },\r\n      body: JSON.stringify(payload)\r\n    })\r\n\r\n    const raw = await res.json()\r\n    if (!res.ok) throw raw\r\n\r\n    successMessage.value = 'Thank you — your feedback has been submitted.'\r\n    setTimeout(() => router.push('/user/tickets'), 1400)\r\n  } catch (err) {\r\n    console.error('submit survey', err)\r\n    errors.value.form = err?.message || 'Submission failed'\r\n  } finally {\r\n    submitting.value = false\r\n  }\r\n}\r\n\r\n</script>\r\n\r\n<template>\r\n  <div class=\"space-y-6\">\r\n    <div class=\"flex items-center justify-between\">\r\n      <div>\r\n        <p class=\"text-sm text-muted-500\">User</p>\r\n        <h2 class=\"text-lg font-semibold text-gray-900\">Ticket Survey</h2>\r\n        <p class=\"text-sm text-muted-500\">Please provide feedback for the selected ticket.</p>\r\n      </div>\r\n      <SuccessBanner :message=\"successMessage\" />\r\n    </div>\r\n\r\n    <UCard>\r\n      <form @submit.prevent=\"submit\" class=\"space-y-6\">\r\n        <div>\r\n          <div v-if=\"loadingTicket\" class=\"py-4\">Loading ticket...</div>\r\n          <div v-else-if=\"ticket\" class=\"flex items-center justify-between\">\r\n            <div>\r\n              <p class=\"text-sm text-muted-500\">Ticket</p>\r\n              <p class=\"text-base font-semibold\">{{ ticket.id }} - {{ ticket.title || ticket.subject }}</p>\r\n              <p class=\"text-sm text-muted-500\">{{ ticket.status }} • {{ formatDate(ticket.created_at) }}</p>\r\n            </div>\r\n            <div class=\"text-sm text-muted-500\">Ticket provided by system</div>\r\n          </div>\r\n          <div v-else class=\"text-sm text-red-600\">Ticket information not available.</div>\r\n        </div>\r\n\r\n        <div>\r\n          <p class=\"text-sm font-semibold text-gray-700 mb-2\">Ratings</p>\r\n          <div class=\"grid gap-4 sm:grid-cols-3\">\r\n            <Ratings label=\"Satisfaction\" v-model=\"form.satisfaction_rating\" />\r\n            <Ratings label=\"Response time\" v-model=\"form.response_time_rating\" />\r\n            <Ratings label=\"Resolution quality\" v-model=\"form.resolution_quality_rating\" />\r\n          </div>\r\n        </div>\r\n\r\n        <Comments v-model=\"form.comments\" :maxLength=\"1000\" />\r\n\r\n        <div>\r\n          <div v-if=\"errors.form\" class=\"text-sm text-red-600 mb-2\">{{ errors.form }}</div>\r\n          <SubmitButtons :loading=\"submitting\" @submit=\"submit\" @cancel=\"$router.back()\" />\r\n        </div>\r\n      </form>\r\n    </UCard>\r\n  </div>\r\n</template>\r\n","<script setup lang=\"ts\">\r\nimport SurveyForm from '~/components/survey/SurveyForm.vue'\r\n</script>\r\n\r\n<template>\r\n    <UDashboardGroup>\r\n        <Sidebar />\r\n        <UDashboardPage class=\"flex flex-col flex-1 min-w-0 overflow-hidden\">\r\n            <Navbar title=\"Survey\" icon=\"i-lucide-clipboard-list\" class=\"w-full\" />\r\n            <div class=\"flex flex-col flex-1 gap-6 p-6 overflow-auto\">\r\n                <SurveyForm />\r\n            </div>\r\n        </UDashboardPage>\r\n    </UDashboardGroup>\r\n</template>"],"names":["_ssrRenderList","_ssrInterpolate","_ssrRenderAttr","_ssrRenderAttrs","_mergeProps","$emit","_push","_parent","_ssrRenderComponent","$router","_createVNode","_createBlock","_toDisplayString","_","_scopeId"],"mappings":"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"}