{"file":"index-BRw5C12v.js","mappings":"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","names":["_withAsyncContext","_unref","_push","_parent","_scopeId","_ssrInterpolate","_createTextVNode","_toDisplayString","_createVNode","_ssrRenderComponent","_"],"sources":["../../../../../../../app/api/history/history.js","../../../../../../../app/components/historyTable.vue","../../../../../../../app/pages/admin/history/index.vue"],"sourcesContent":["export const getHistory = async (criteria = {}) => {\r\n    const token = useCookie('auth_token')\r\n    let bearer = token.value || ''\r\n    try {\r\n        bearer = decodeURIComponent(bearer)\r\n    } catch {\r\n        // keep original if decoding fails\r\n    }\r\n\r\n    const params = new URLSearchParams()\r\n    if (criteria.status) params.append('status', criteria.status)\r\n    if (criteria.priority) params.append('priority', criteria.priority)\r\n    if (criteria.category_id) params.append('category_id', criteria.category_id)\r\n\r\n    // Support legacy name parameter if passed as string, though unlikely given typescript usage elsewhere\r\n    if (typeof criteria === 'string') {\r\n        params.append('name', criteria)\r\n    } else if (criteria.name) {\r\n        params.append('name', criteria.name)\r\n    }\r\n\r\n    let url = 'http://localhost:8000/api/history/logs'\r\n    const queryString = params.toString()\r\n    if (queryString) {\r\n        url += `?${queryString}`\r\n    }\r\n\r\n    const response = await fetch(url, {\r\n        method: 'GET',\r\n        headers: {\r\n            Accept: 'application/json',\r\n            'Content-Type': 'application/json',\r\n            Authorization: `Bearer ${bearer}`\r\n        }\r\n    })\r\n\r\n    const raw = await response.json()\r\n    if (!response.ok) {\r\n        throw raw\r\n    }\r\n    // Support paginated API: { data: { data: [...] } }\r\n    if (raw?.data?.data && Array.isArray(raw.data.data)) return raw.data.data\r\n    if (Array.isArray(raw)) return raw\r\n    if (Array.isArray(raw.data)) return raw.data\r\n    if (Array.isArray(raw.tickets)) return raw.tickets\r\n    return []\r\n}","<script setup lang=\"ts\">\r\nimport { getHistory } from '~/api/history/history'\r\nimport { getUsers } from '~/api/users/users'\r\nimport { computed, watchEffect } from 'vue'\r\n\r\nconst { data: history, status, error, refresh } = await useAsyncData(\r\n  'history-list',\r\n  () => getHistory(),\r\n  { server: false, lazy: false }\r\n)\r\n\r\nconst data = computed(() => {\r\n  if (!history.value) return []\r\n  if (Array.isArray(history.value)) return history.value\r\n  if (history.value.data && Array.isArray(history.value.data)) return history.value.data\r\n  if (history.value.data && history.value.data.data && Array.isArray(history.value.data.data)) return history.value.data.data\r\n  return []\r\n})\r\n\r\nconst { data: users } = await useAsyncData('all-users', () => getUsers(), { server: false, lazy: false })\r\n\r\nconst usersMap = computed(() => {\r\n  const map = {}\r\n  const usersArr = (users.value && (Array.isArray(users.value) ? users.value : users.value.data)) || []\r\n  ;(usersArr || []).forEach(u => {\r\n    if (u && u.id != null) map[String(u.id)] = u.username || u.name || u.email || `User ${u.id}`\r\n  })\r\n  return map\r\n})\r\n\r\nconst getActorName = (row) => {\r\n  const orig = row?.original || {}\r\n  const id = orig.actor_id || orig.user_id || orig.causer_id || (orig.actor && orig.actor.id) || (orig.causer && orig.causer.id)\r\n  if (id != null) return usersMap.value[String(id)] || `User ${id}`\r\n  return orig.actor_username || orig.causer_username || orig.username || 'Unknown'\r\n}\r\n\r\nwatchEffect(() => {\r\n  if (history.value) {\r\n    // eslint-disable-next-line no-console\r\n    // console.log('History payload sample:', history.value?.data || history.value)\r\n  }\r\n  if (users.value) {\r\n    // eslint-disable-next-line no-console\r\n    // console.log('Users payload sample:', users.value)\r\n  }\r\n})\r\n\r\n\r\nconst columns = [\r\n  { accessorKey: 'id', header: 'ID' },\r\n  { accessorKey: 'ticket_id', header: 'Ticket ID' },\r\n  { accessorKey: 'action', header: 'Action' },\r\n  { accessorKey: 'actor_username', header: 'Actor Username' },\r\n  { accessorKey: 'notes', header: 'Notes' },\r\n\r\n]\r\n\r\n\r\n\r\n\r\n\r\nonNuxtReady(() => {\r\n  refresh()\r\n})\r\n</script>\r\n\r\n<template>\r\n  <UTable \r\n  :data=\"data\" \r\n  :columns=\"columns\"\r\n  :loading=\"status === 'pending'\"\r\n  class=\"flex-1\"\r\n>\r\n  <template #actor_username-cell=\"{ row }\">\r\n    <NuxtLink\r\n      :to=\"`/admin/users/${row.original.id}`\"\r\n      class=\"text-primary underline hover:text-primary-600\"\r\n    >\r\n      {{ getActorName(row) }}\r\n    </NuxtLink>\r\n  </template>\r\n\r\n\r\n</UTable>\r\n\r\n</template>\r\n","<template>\r\n  <UDashboardGroup>\r\n    <Sidebar />\r\n    <UDashboardPage class=\"flex flex-col flex-1 min-w-0 overflow-hidden\">\r\n      <Navbar title=\"Dashboard\" icon=\"i-lucide-house\" class=\"w-full\" />\r\n      <div class=\"flex flex-col flex-1 gap-6 p-6 overflow-auto\">\r\n        <UDashboardPageHeader title=\"Dashboard\" description=\"Welcome to your dashboard.\" />\r\n        <HistoryTable class=\"flex-1 w-full\" />\r\n      </div>\r\n    </UDashboardPage>\r\n  </UDashboardGroup>\r\n</template>\r\n"],"version":3}