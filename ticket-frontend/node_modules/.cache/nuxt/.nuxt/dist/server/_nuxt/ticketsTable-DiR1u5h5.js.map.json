{"file":"ticketsTable-DiR1u5h5.js","mappings":"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","names":["_unref","_push","_parent","_scopeId","_createVNode","_ssrInterpolate","_createTextVNode","_toDisplayString"],"sources":["../../../../../../../app/components/ticketsTable.vue"],"sourcesContent":["<script setup lang=\"ts\">\r\nimport { ref, computed, watch } from 'vue'\r\nimport { getTickets } from '~/api/tickets/tickets'\r\n\r\nconst props = defineProps<{\r\n  filters?: {\r\n    status?: string\r\n    priority?: string\r\n    category_id?: string\r\n  }\r\n  forceStatus?: string\r\n}>()\r\n\r\nconst columns = [\r\n  { accessorKey: 'id', header: 'ID' },\r\n  { accessorKey: 'title', header: 'Title' },\r\n  { accessorKey: 'description', header: 'Description' },\r\n  { accessorKey: 'status', header: 'Status' },\r\n  { accessorKey: 'priority', header: 'Priority' },\r\n  { accessorKey: 'category.name', header: 'Category' },\r\n  { accessorKey: 'created_at', header: 'Created At' },\r\n  {\r\n    accessorKey: 'actions',\r\n    header: 'Actions',\r\n  }\r\n]\r\n\r\n\r\nconst currentPage = ref(1)\r\nconst perPage = ref(20)\r\n\r\nconst { data: ticketsRaw, status, refresh } = useAsyncData(\r\n  () => `tickets-page-${currentPage.value}-${props.filters?.status || ''}-${props.filters?.priority || ''}-${props.filters?.category_id || ''}`,\r\n  () => getTickets({ ...props.filters, status: (props.filters?.status ?? props.forceStatus), page: currentPage.value, per_page: perPage.value, _raw: true }),\r\n  {\r\n    watch: [() => props.filters?.status, () => props.filters?.priority, () => props.filters?.category_id, () => currentPage.value],\r\n    server: false,\r\n    lazy: false,\r\n    default: () => null\r\n  }\r\n)\r\n\r\nconst data = computed(() => {\r\n  if (!ticketsRaw.value) return []\r\n  const raw = ticketsRaw.value\r\n  if (Array.isArray(raw)) return raw\r\n  if (raw?.data && Array.isArray(raw.data)) return raw.data\r\n  if (raw?.data?.data && Array.isArray(raw.data.data)) return raw.data.data\r\n  if (Array.isArray(raw.tickets)) return raw.tickets\r\n  return []\r\n})\r\n\r\nconst total = ref(0)\r\nconst lastPage = ref(1)\r\n\r\nwatch(ticketsRaw, (v) => {\r\n  if (!v) {\r\n    total.value = 0\r\n    lastPage.value = 1\r\n    return\r\n  }\r\n  const meta = v?.data?.meta || v?.meta || v?.pagination || v?.data || null\r\n  if (meta && (meta.total || meta.last_page || meta.current_page || meta.per_page)) {\r\n    total.value = meta.total ?? meta.total_items ?? total.value\r\n    lastPage.value = meta.last_page ?? meta.lastPage ?? meta.total_pages ?? (meta.total && (meta.per_page ?? perPage.value) ? Math.ceil((meta.total)/(meta.per_page ?? perPage.value)) : lastPage.value)\r\n    perPage.value = meta.per_page ?? meta.perPage ?? perPage.value\r\n    if (meta.current_page && Number(meta.current_page) !== currentPage.value) {\r\n      currentPage.value = Number(meta.current_page)\r\n    }\r\n  } else {\r\n    if (Array.isArray(v) || Array.isArray(v?.data) || Array.isArray(v?.data?.data)) {\r\n      total.value = (Array.isArray(v) ? v.length : (Array.isArray(v.data) ? v.data.length : (Array.isArray(v.data?.data) ? v.data.data.length : 0)))\r\n      lastPage.value = 1\r\n    }\r\n  }\r\n})\r\n\r\nconst prevPage = () => { if (currentPage.value > 1) currentPage.value-- }\r\nconst nextPage = () => { if (currentPage.value < lastPage.value) currentPage.value++ }\r\nconst goToPage = (n) => { if (n >= 1 && n <= lastPage.value) currentPage.value = n }\r\n\r\nconst prioritiesClass = (s) => {\r\n  const map = {\r\n    low: 'bg-green-100 text-green-800',\r\n    medium: 'bg-yellow-100 text-yellow-800',\r\n    high: 'bg-orange-100 text-orange-800',\r\n    critical: 'bg-red-100 text-red-800'\r\n  }\r\n  return map[String(s)] || 'bg-gray-50 text-gray-700'\r\n}\r\n\r\nconst statusClass = (s) => {\r\n  const map = {\r\n    open: 'bg-green-100 text-green-800',\r\n    in_progress: 'bg-yellow-100 text-yellow-800',\r\n    pending: 'bg-orange-100 text-orange-800',\r\n    resolved: 'bg-blue-100 text-blue-800',\r\n    closed: 'bg-gray-100 text-gray-600'\r\n  }\r\n  return map[String(s)] || 'bg-gray-50 text-gray-700'\r\n}\r\n\r\nconst statusLabel = (s) => {\r\n  if (!s) return ''\r\n  if (s === 'in_progress') return 'In Progress'\r\n  return String(s).replace(/_/g, ' ').replace(/\\b\\w/g, l => l.toUpperCase())\r\n}\r\n\r\nconst formatDate = (val) => {\r\n  if (!val) return ''\r\n  const d = new Date(val)\r\n  if (Number.isNaN(d.getTime())) return String(val)\r\n  const day = d.getDate()\r\n  const month = d.toLocaleString('en-US', { month: 'short' })\r\n  const year = d.getFullYear()\r\n  let hour = d.getHours()\r\n  const minute = d.getMinutes()\r\n  const ampm = hour >= 12 ? 'pm' : 'am'\r\n  hour = hour % 12 || 12\r\n  const minutePart = minute ? `:${String(minute).padStart(2, '0')}` : ''\r\n  return `${day} ${month} ${year} ${hour}${minutePart}${ampm}`\r\n}\r\n\r\nconst role = useCookie('user_role')\r\n\r\nconst link = computed(() => {\r\n  if (role.value === 'technician') return '/technician/tickets/'\r\n  if (role.value === 'supervisor') return '/supervisor/tickets/'\r\n  if (role.value === 'user') return '/user/tickets/'\r\n  return '/'\r\n})\r\n\r\n\r\nonNuxtReady(() => {\r\n  refresh()\r\n})\r\n\r\n// reset to first page when filters change\r\nwatch([\r\n  () => props.filters?.status,\r\n  () => props.filters?.priority,\r\n  () => props.filters?.category_id\r\n], () => {\r\n  currentPage.value = 1\r\n})\r\n</script>\r\n\r\n<template>\r\n  <UTable \r\n    :data=\"data\" \r\n    :columns=\"columns\"\r\n    :loading=\"status === 'pending'\"\r\n  >\r\n    <template #actions-cell=\"{ row }\">\r\n      <div class=\"flex justify-end gap-2\">\r\n        <UButton\r\n          size=\"xs\"\r\n          color=\"primary\"\r\n          variant=\"soft\"\r\n          icon=\"i-lucide-eye\"\r\n          :to=\"`${link}${row.original.id}`\"\r\n        >\r\n          View\r\n        </UButton>\r\n      </div>\r\n    </template>\r\n      <template #priority-cell=\"{ row }\">\r\n        <div class=\"flex items-center\">\r\n          <UBadge color=\"neutral\" variant=\"soft\" :class=\"`${prioritiesClass(row.original.priority)} px-2 py-1 text-xs font-semibold`\">\r\n            {{ statusLabel(row.original.priority) }}\r\n          </UBadge>\r\n        </div>\r\n      </template>\r\n      <template #status-cell=\"{ row }\">\r\n        <div class=\"flex items-center\">\r\n          <UBadge color=\"neutral\" variant=\"soft\" :class=\"`${statusClass(row.original.status)} px-2 py-1 text-xs font-semibold`\">\r\n            {{ statusLabel(row.original.status) }}\r\n          </UBadge>\r\n        </div>\r\n      </template>\r\n  </UTable>\r\n  <!-- Pagination controls -->\r\n  <div class=\"mt-4 flex items-center justify-between\">\r\n    <div class=\"text-sm text-gray-600\">\r\n      Showing\r\n      <span v-if=\"data.length\">{{ ((currentPage-1)*perPage)+1 }}-{{ ((currentPage-1)*perPage) + data.length }}</span>\r\n      <span v-else>0</span>\r\n      of {{ total }}\r\n    </div>\r\n    <div class=\"flex items-center gap-2\">\r\n      <UButton size=\"sm\" variant=\"ghost\" :disabled=\"currentPage === 1\" @click=\"prevPage\">Prev</UButton>\r\n      <div class=\"px-3 text-sm\">Page {{ currentPage }} / {{ lastPage }}</div>\r\n      <UButton size=\"sm\" variant=\"ghost\" :disabled=\"currentPage === lastPage\" @click=\"nextPage\">Next</UButton>\r\n    </div>\r\n  </div>\r\n</template>\r\n"],"version":3}