{"file":"updateTicketStatus-Da378j06.js","mappings":"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","names":["_ssrRenderComponent","_mergeProps","_push","_parent","_ssrRenderList","_ssrInterpolate","_","_scopeId","_createVNode","_createBlock","_Fragment","_renderList","_toDisplayString"],"sources":["../../../../../../../app/api/comments/comments.js","../../../../../../../app/components/TicketComments.vue","../../../../../../../app/api/tickets/updateTicketStatus.js"],"sourcesContent":["export const getComments = async (ticketId) => {\r\n  if (!ticketId) throw new Error('Ticket id is required')\r\n\r\n  const token = useCookie('auth_token')\r\n  let bearer = token.value || ''\r\n  try {\r\n    bearer = decodeURIComponent(bearer)\r\n  } catch {}\r\n\r\n  const url = `http://localhost:8000/api/tickets/${encodeURIComponent(ticketId)}/comments`\r\n\r\n  const response = await fetch(url, {\r\n    method: 'GET',\r\n    headers: {\r\n      Accept: 'application/json',\r\n      Authorization: `Bearer ${bearer}`\r\n    }\r\n  })\r\n\r\n  const raw = await response.json()\r\n  if (!response.ok) throw raw\r\n\r\n  return raw.data ?? raw\r\n}\r\n\r\nexport const addComment = async (ticketId, payload) => {\r\n  if (!ticketId) throw new Error('Ticket id is required')\r\n  if (!payload) throw new Error('Comment payload is required')\r\n\r\n  const token = useCookie('auth_token')\r\n  let bearer = token.value || ''\r\n  try {\r\n    bearer = decodeURIComponent(bearer)\r\n  } catch {}\r\n\r\n  const url = `http://localhost:8000/api/tickets/${encodeURIComponent(ticketId)}/comments`\r\n\r\n  const response = await fetch(url, {\r\n    method: 'POST',\r\n    headers: {\r\n      Accept: 'application/json',\r\n      'Content-Type': 'application/json',\r\n      Authorization: `Bearer ${bearer}`\r\n    },\r\n    body: JSON.stringify(payload)\r\n  })\r\n\r\n  const raw = await response.json()\r\n  if (!response.ok) throw raw\r\n\r\n  return raw.data ?? raw\r\n}\r\n","<template>\r\n  <UCard class=\"mt-4\">\r\n    <div class=\"p-4\">\r\n      <h3 class=\"text-lg font-semibold mb-3\">Comments</h3>\r\n      <div class=\"space-y-3\">\r\n        <div v-if=\"loading\" class=\"text-sm text-gray-500\">Loading comments...</div>\r\n        <div v-else>\r\n          <div class=\"space-y-3 max-h-80 overflow-y-auto pr-2\">\r\n            <div v-if=\"!comments.length\" class=\"text-sm text-gray-500\">No comments yet</div>\r\n            <div v-else class=\"space-y-3\">\r\n              <div v-for=\"c in comments\" :key=\"c.id\" class=\"p-3 border rounded\">\r\n                <div class=\"text-sm text-gray-800 whitespace-pre-line\">{{ c.content }}</div>\r\n                <div class=\"text-xs text-gray-400 mt-1\">by {{ c.user_id ? `User #${c.username}` : (c.user?.name || 'Unknown') }} â€¢ {{ c.created_at ? formatDate(c.created_at) : (c.updated_at ? formatDate(c.updated_at) : '') }}</div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"pt-2\">\r\n          <UFormGroup label=\"Add comment\" name=\"comment\">\r\n            <UInput v-model=\"newComment\" placeholder=\"Write a comment...\" />\r\n          </UFormGroup>\r\n\r\n          <div v-if=\"canSetVisibility\" class=\"mt-2\">\r\n            <UFormGroup label=\"Visibility\" name=\"visibility\">\r\n              <USelect v-model=\"isUserVisible\" :items=\"[{ label: 'Public', value: true }, { label: 'Private', value: false }]\" />\r\n            </UFormGroup>\r\n          </div>\r\n          <div class=\"flex justify-end gap-2 mt-2\">\r\n            <UButton size=\"sm\" color=\"neutral\" variant=\"ghost\" @click=\"newComment = ''\">Cancel</UButton>\r\n            <UButton size=\"sm\" color=\"primary\" :loading=\"posting\" @click=\"postComment\">Post</UButton>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </UCard>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, watch, onMounted, computed } from 'vue'\r\nimport { useCookie } from 'nuxt/app'\r\nimport { getComments, addComment } from '~/api/comments/comments'\r\n\r\nconst props = defineProps({\r\n  ticketId: {\r\n    type: [String, Number],\r\n    required: true\r\n  }\r\n})\r\nconst comments = ref([])\r\nconst loading = ref(false)\r\nconst newComment = ref('')\r\nconst posting = ref(false)\r\nconst isUserVisible = ref(true)\r\n\r\nconst userRoleCookie = useCookie('user_role')\r\nconst userRole = computed(() => String(userRoleCookie?.value || '').toLowerCase())\r\nconst canSetVisibility = computed(() => ['supervisor', 'technician'].includes(userRole.value))\r\n\r\nconst load = async () => {\r\n  if (!props.ticketId) return\r\n  loading.value = true\r\n  try {\r\n    const data = await getComments(String(props.ticketId))\r\n    comments.value = Array.isArray(data) ? data : (data?.data || [])\r\n  } catch (e) {\r\n    console.error('Failed to load comments', e)\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n\r\nconst postComment = async () => {\r\n  if (!newComment.value || posting.value) return\r\n  posting.value = true\r\n  try {\r\n    const payload = { content: newComment.value, is_user_visible: Boolean(isUserVisible.value) }\r\n    const res = await addComment(String(props.ticketId), payload)\r\n    const created = res?.data ? res.data : res\r\n    if (created) comments.value.unshift(created)\r\n    newComment.value = ''\r\n    isUserVisible.value = true\r\n  } catch (e) {\r\n    console.error('Failed to post comment', e)\r\n  } finally {\r\n    posting.value = false\r\n  }\r\n}\r\n\r\nconst formatDate = (iso) => new Date(iso).toLocaleString()\r\n\r\nonMounted(load)\r\nwatch(() => props.ticketId, () => load())\r\n</script>\r\n","export const updateTicketStatus = async (id, status) => {\r\n    if (!id) throw new Error('Ticket id is required')\r\n    if (!status) throw new Error('Status is required')\r\n    const token = useCookie('auth_token')\r\n    let bearer = token.value || ''\r\n    try {\r\n        bearer = decodeURIComponent(bearer)\r\n    } catch {\r\n        // keep original if decoding fails\r\n    }\r\n    const url = `http://localhost:8000/api/tickets/${encodeURIComponent(id)}/status`\r\n\r\n    const response = await fetch(url, {\r\n        method: 'PUT',\r\n        headers: {\r\n            Accept: 'application/json',\r\n            'Content-Type': 'application/json',\r\n            Authorization: `Bearer ${bearer}`\r\n        },\r\n        body: JSON.stringify({ status })\r\n    })\r\n    const raw = await response.json()\r\n    if (!response.ok) {\r\n        throw raw\r\n    }\r\n    if (raw?.data) return raw.data\r\n    return raw\r\n}"],"version":3}