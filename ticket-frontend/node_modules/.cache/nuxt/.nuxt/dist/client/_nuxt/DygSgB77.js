import{_ as re,a as ne,b as oe}from"./Ddr_hDuZ.js";import{_ as ue}from"./D3QffkNq.js";import{a7 as de,L as ce,R as ge,z as Z,_ as ee,A as pe,P as me,$ as fe,a0 as ve}from"./GPD3P-m0.js";import{C as ye,K as he,e as be,V as xe,l as le,h as _e,k as j,o,w as A,a as s,r as Q,c as p,p as q,m as te,f as g,L as U,n as we,Y as X,g as ze,P as ke,z as w,a4 as Ie,a2 as ae,b as m,v as Ce,F as ie,q as se,t as R,d as H}from"./BGim2kwq.js";import{_ as Ae}from"./CFZJElYW.js";import"./kDLvYEi9.js";import"./K8s1tnq0.js";import"./CCraGg39.js";const qe={slots:{root:"relative inline-flex items-center",base:["w-full rounded-md border-0 appearance-none placeholder:text-dimmed focus:outline-none disabled:cursor-not-allowed disabled:opacity-75","transition-colors"],leading:"absolute start-0 flex items-start",leadingIcon:"shrink-0 text-dimmed",leadingAvatar:"shrink-0",leadingAvatarSize:"",trailing:"absolute end-0 flex items-start",trailingIcon:"shrink-0 text-dimmed"},variants:{fieldGroup:{horizontal:{root:"group has-focus-visible:z-[1]",base:"group-not-only:group-first:rounded-e-none group-not-only:group-last:rounded-s-none group-not-last:group-not-first:rounded-none"},vertical:{root:"group has-focus-visible:z-[1]",base:"group-not-only:group-first:rounded-b-none group-not-only:group-last:rounded-t-none group-not-last:group-not-first:rounded-none"}},size:{xs:{base:"px-2 py-1 text-xs gap-1",leading:"ps-2 inset-y-1",trailing:"pe-2 inset-y-1",leadingIcon:"size-4",leadingAvatarSize:"3xs",trailingIcon:"size-4"},sm:{base:"px-2.5 py-1.5 text-xs gap-1.5",leading:"ps-2.5 inset-y-1.5",trailing:"pe-2.5 inset-y-1.5",leadingIcon:"size-4",leadingAvatarSize:"3xs",trailingIcon:"size-4"},md:{base:"px-2.5 py-1.5 text-sm gap-1.5",leading:"ps-2.5 inset-y-1.5",trailing:"pe-2.5 inset-y-1.5",leadingIcon:"size-5",leadingAvatarSize:"2xs",trailingIcon:"size-5"},lg:{base:"px-3 py-2 text-sm gap-2",leading:"ps-3 inset-y-2",trailing:"pe-3 inset-y-2",leadingIcon:"size-5",leadingAvatarSize:"2xs",trailingIcon:"size-5"},xl:{base:"px-3 py-2 text-base gap-2",leading:"ps-3 inset-y-2",trailing:"pe-3 inset-y-2",leadingIcon:"size-6",leadingAvatarSize:"xs",trailingIcon:"size-6"}},variant:{outline:"text-highlighted bg-default ring ring-inset ring-accented",soft:"text-highlighted bg-elevated/50 hover:bg-elevated focus:bg-elevated disabled:bg-elevated/50",subtle:"text-highlighted bg-elevated ring ring-inset ring-accented",ghost:"text-highlighted bg-transparent hover:bg-elevated focus:bg-elevated disabled:bg-transparent dark:disabled:bg-transparent",none:"text-highlighted bg-transparent"},color:{primary:"",secondary:"",success:"",info:"",warning:"",error:"",neutral:""},leading:{true:""},trailing:{true:""},loading:{true:""},highlight:{true:""},type:{file:"file:me-1.5 file:font-medium file:text-muted file:outline-none"},autoresize:{true:{base:"resize-none"}}},compoundVariants:[{color:"primary",variant:["outline","subtle"],class:"focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-primary"},{color:"secondary",variant:["outline","subtle"],class:"focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-secondary"},{color:"success",variant:["outline","subtle"],class:"focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-success"},{color:"info",variant:["outline","subtle"],class:"focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-info"},{color:"warning",variant:["outline","subtle"],class:"focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-warning"},{color:"error",variant:["outline","subtle"],class:"focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-error"},{color:"primary",highlight:!0,class:"ring ring-inset ring-primary"},{color:"secondary",highlight:!0,class:"ring ring-inset ring-secondary"},{color:"success",highlight:!0,class:"ring ring-inset ring-success"},{color:"info",highlight:!0,class:"ring ring-inset ring-info"},{color:"warning",highlight:!0,class:"ring ring-inset ring-warning"},{color:"error",highlight:!0,class:"ring ring-inset ring-error"},{color:"neutral",variant:["outline","subtle"],class:"focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-inverted"},{color:"neutral",highlight:!0,class:"ring ring-inset ring-inverted"},{leading:!0,size:"xs",class:"ps-7"},{leading:!0,size:"sm",class:"ps-8"},{leading:!0,size:"md",class:"ps-9"},{leading:!0,size:"lg",class:"ps-10"},{leading:!0,size:"xl",class:"ps-11"},{trailing:!0,size:"xs",class:"pe-7"},{trailing:!0,size:"sm",class:"pe-8"},{trailing:!0,size:"md",class:"pe-9"},{trailing:!0,size:"lg",class:"pe-10"},{trailing:!0,size:"xl",class:"pe-11"},{loading:!0,leading:!0,class:{leadingIcon:"animate-spin"}},{loading:!0,leading:!1,trailing:!0,class:{trailingIcon:"animate-spin"}}],defaultVariants:{size:"md",color:"primary",variant:"outline"}},Se=["id","value","name","rows","placeholder","disabled","required"],Be=Object.assign({inheritAttrs:!1},{__name:"UTextarea",props:{as:{type:null,required:!1},id:{type:String,required:!1},name:{type:String,required:!1},placeholder:{type:String,required:!1},color:{type:null,required:!1},variant:{type:null,required:!1},size:{type:null,required:!1},required:{type:Boolean,required:!1},autofocus:{type:Boolean,required:!1},autofocusDelay:{type:Number,required:!1,default:0},autoresize:{type:Boolean,required:!1},autoresizeDelay:{type:Number,required:!1,default:0},disabled:{type:Boolean,required:!1},rows:{type:Number,required:!1,default:3},maxrows:{type:Number,required:!1,default:0},highlight:{type:Boolean,required:!1},modelValue:{type:null,required:!1},defaultValue:{type:null,required:!1},modelModifiers:{type:Object,required:!1},class:{type:null,required:!1},ui:{type:null,required:!1},icon:{type:null,required:!1},avatar:{type:Object,required:!1},leading:{type:Boolean,required:!1},leadingIcon:{type:null,required:!1},trailing:{type:Boolean,required:!1},trailingIcon:{type:null,required:!1},loading:{type:Boolean,required:!1},loadingIcon:{type:null,required:!1}},emits:["update:modelValue","blur","change"],setup(u,{expose:r,emit:S}){const e=u,b=S,l=ye(),d=de(e,"modelValue",b,{defaultValue:e.defaultValue}),z=he(),{emitFormFocus:k,emitFormBlur:h,emitFormInput:f,emitFormChange:B,size:c,color:x,id:I,name:D,highlight:P,disabled:Y,ariaAttrs:K}=ce(e,{deferInputValidation:!0}),{isLeading:M,isTrailing:L,leadingIconName:$,trailingIconName:O}=ge(e),v=be(()=>Z({extend:Z(qe),...z.ui?.textarea||{}})({color:x.value,variant:e.variant,size:c?.value,loading:e.loading,highlight:P.value,autoresize:e.autoresize,leading:M.value||!!e.avatar||!!l.leading,trailing:L.value||!!l.trailing})),y=xe("textareaRef");function E(i){e.modelModifiers?.trim&&(i=i?.trim()??null),e.modelModifiers?.number&&(i=fe(i)),e.modelModifiers?.nullable&&(i||=null),e.modelModifiers?.optional&&(i||=void 0),d.value=i,f()}function t(i){V(),e.modelModifiers?.lazy||E(i.target.value)}function a(i){const _=i.target.value;e.modelModifiers?.lazy&&E(_),e.modelModifiers?.trim&&(i.target.value=_.trim()),B(),b("change",i)}function F(i){h(),b("blur",i)}function T(){e.autofocus&&y.value?.focus()}function V(){if(e.autoresize&&y.value){y.value.rows=e.rows;const i=y.value.style.overflow;y.value.style.overflow="hidden";const _=window.getComputedStyle(y.value),N=Number.parseInt(_.paddingTop),G=Number.parseInt(_.paddingBottom),W=N+G,J=Number.parseInt(_.lineHeight),{scrollHeight:n}=y.value,C=(n-W)/J;C>e.rows&&(y.value.rows=e.maxrows?Math.min(C,e.maxrows):C),y.value.style.overflow=i}}return le(d,()=>{we(V)}),_e(()=>{setTimeout(()=>{T()},e.autofocusDelay),setTimeout(()=>{V()},e.autoresizeDelay)}),r({textareaRef:y}),(i,_)=>(o(),j(g(me),{as:u.as,"data-slot":"root",class:U(v.value.root({class:[e.ui?.root,e.class]}))},{default:A(()=>[s("textarea",te({id:g(I),ref_key:"textareaRef",ref:y,value:g(d),name:g(D),rows:u.rows,placeholder:u.placeholder,"data-slot":"base",class:v.value.base({class:e.ui?.base}),disabled:g(Y),required:u.required},{...i.$attrs,...g(K)},{onInput:t,onBlur:F,onChange:a,onFocus:_[0]||(_[0]=(...N)=>g(k)&&g(k)(...N))}),null,16,Se),Q(i.$slots,"default",{ui:v.value}),g(M)||u.avatar||l.leading?(o(),p("span",{key:0,"data-slot":"leading",class:U(v.value.leading({class:e.ui?.leading}))},[Q(i.$slots,"leading",{ui:v.value},()=>[g(M)&&g($)?(o(),j(ee,{key:0,name:g($),"data-slot":"leadingIcon",class:U(v.value.leadingIcon({class:e.ui?.leadingIcon}))},null,8,["name","class"])):u.avatar?(o(),j(pe,te({key:1,size:e.ui?.leadingAvatarSize||v.value.leadingAvatarSize()},u.avatar,{"data-slot":"leadingAvatar",class:v.value.leadingAvatar({class:e.ui?.leadingAvatar})}),null,16,["size","class"])):q("",!0)])],2)):q("",!0),g(L)||l.trailing?(o(),p("span",{key:1,"data-slot":"trailing",class:U(v.value.trailing({class:e.ui?.trailing}))},[Q(i.$slots,"trailing",{ui:v.value},()=>[g(O)?(o(),j(ee,{key:0,name:g(O),"data-slot":"trailingIcon",class:U(v.value.trailingIcon({class:e.ui?.trailingIcon}))},null,8,["name","class"])):q("",!0)])],2)):q("",!0)]),_:3},8,["as","class"]))}}),De=async u=>{let S=X("auth_token").value||"";try{S=decodeURIComponent(S)}catch{}if(!u||String(u).length<2)return[];const e=`http://localhost:8000/api/categories/suggest?q=${encodeURIComponent(u)}`,b=await fetch(e,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${S}`}}),l=await b.json();if(!b.ok)throw l;return Array.isArray(l)?l:Array.isArray(l.data)?l.data:Array.isArray(l.categories)?l.categories:[]},Te=async({title:u,description:r,priority:S,status:e,category_id:b,submitter_id:l,assigned_to_id:d,attachments:z})=>{let h=X("auth_token").value||"";try{h=decodeURIComponent(h)}catch{}const f=X("user_role").value;if(f&&!["user","technician","supervisor","admin"].includes(f))throw new Error("Invalid role. Allowed roles: user, technician, supervisor, admin");const c=new FormData;c.append("title",u),r&&c.append("description",r),c.append("priority",S),e&&c.append("status",e),b&&c.append("category_id",b),l&&c.append("submitter_id",l),d&&c.append("assigned_tech_id",d),z&&z.length&&z.forEach(D=>{c.append("attachments[]",D)});const x=await fetch("http://localhost:8000/api/tickets",{method:"POST",headers:{Accept:"application/json",Authorization:`Bearer ${h}`},body:c}),I=await x.json();if(!x.ok)throw I;return I},Ve={class:"flex flex-col flex-1 gap-6 p-6 overflow-auto"},Ue={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},Me={class:"relative"},$e={key:0,class:"absolute right-2 top-2 text-xs text-muted"},Fe={key:1,class:"absolute z-50 mt-1 w-full bg-white border rounded-md shadow-sm max-h-48 overflow-auto"},Ne=["onClick"],Re={key:2,class:"absolute z-50 mt-1 w-full bg-white border rounded-md shadow-sm px-3 py-2 text-sm text-muted"},je={key:3,class:"absolute right-2 top-2"},Pe={class:"text-xs text-muted mt-1"},Le={class:"font-medium"},Oe={key:0,class:"mt-2 text-sm text-error"},Ee={key:1,class:"mt-3"},Ge={class:"divide-y divide-gray-200 bg-white rounded-md shadow-sm"},He={class:"flex items-center gap-2"},Ye={class:"font-medium"},Ke={class:"text-xs text-muted"},We={key:0,class:"mt-1 flex items-center"},Je=["src","alt"],Qe={key:1,class:"mt-1 flex items-center"},Xe=["src"],Ze={key:2,class:"mt-1 text-xs text-muted"},et={class:"flex justify-end gap-3 pt-2"},ut=ze({__name:"create",setup(u){const r=ke({title:"",description:"",priority:"",status:"",category_id:null,submitter_id:null,assigned_to_id:null}),S=w(["low","medium","critical"]),e=w(!1),b=Ie(),l=w([]),d=w([]),z=w(!1),k=w(""),h=w(""),f=w([]),B=w(!1);let c=null;const x=w(null),I=w("");let D=null;const P=()=>{d.value=l.value.map(t=>t.type.startsWith("image/")?{url:URL.createObjectURL(t),type:"image",name:t.name}:t.type==="application/pdf"?{url:URL.createObjectURL(t),type:"pdf",name:t.name}:{url:"",type:"other",name:t.name})},Y=t=>{const a=Array.from(t.target.files||[]);if(a.find(T=>T.size>10*1024*1024)){k.value="Each file must be less than 10MB.",l.value=[],d.value=[];return}k.value="",l.value=a,P()},K=t=>{if(t.preventDefault(),z.value=!1,t.dataTransfer?.files){const a=Array.from(t.dataTransfer.files);if(a.find(T=>T.size>10*1024*1024)){k.value="Each file must be less than 10MB.",l.value=[],d.value=[];return}k.value="",l.value=a,P()}},M=t=>{t.preventDefault(),z.value=!0},L=t=>{t.preventDefault(),z.value=!1},$=async t=>{if(!t||t.length<2){f.value=[];return}B.value=!0;try{const a=await De(t);f.value=Array.isArray(a)?a:a.data||a.categories||[]}catch{f.value=[]}finally{B.value=!1}},O=t=>{h.value=t.target.value,x.value=null,I.value="",c&&clearTimeout(c),c=setTimeout(()=>$(h.value),300)};le(()=>r.title,t=>{x.value||(D&&clearTimeout(D),D=setTimeout(()=>{t&&String(t).length>=2?$(String(t)):f.value=[]},300))});const v=t=>{const a=t?.id??t?.value??null;x.value=a,I.value=t?.name||t?.title||t?.label||"",r.category_id=a,h.value=I.value,f.value=[]},y=()=>{x.value=null,I.value="",h.value="",r.category_id=null,f.value=[]},E=async()=>{if(!e.value){e.value=!0;try{await Te({title:r.title,description:r.description,priority:r.priority,status:r.status,category_id:x.value??null,submitter_id:r.submitter_id,assigned_to_id:r.assigned_to_id,attachments:l.value}),await b.push("/user/tickets")}catch(t){console.error("Failed to create ticket",t)}finally{e.value=!1}}};return(t,a)=>{const F=ne,T=oe,V=ue,i=ae("UFormGroup"),_=Be,N=Ae,G=ve,W=ae("UDashboardPage"),J=re;return o(),j(J,null,{default:A(()=>[m(F),m(W,{class:"flex flex-col flex-1 min-w-0 overflow-hidden"},{default:A(()=>[m(T,{title:"Create ticket",icon:"i-lucide-ticket-plus",class:"w-full"}),s("div",Ve,[s("form",{class:"flex flex-col gap-4 max-w-3xl w-full",onSubmit:Ce(E,["prevent"])},[s("div",Ue,[m(i,{label:"Title",name:"title"},{default:A(()=>[m(V,{modelValue:r.title,"onUpdate:modelValue":a[0]||(a[0]=n=>r.title=n),placeholder:"Ticket Title",required:"",maxlength:"255"},null,8,["modelValue"])]),_:1}),m(i,{label:"Description",name:"description",class:"sm:col-span-2"},{default:A(()=>[m(_,{modelValue:r.description,"onUpdate:modelValue":a[1]||(a[1]=n=>r.description=n),placeholder:"Ticket Description",rows:"6",class:"min-h-32 resize-vertical",maxlength:"2000"},null,8,["modelValue"]),a[4]||(a[4]=s("p",{class:"text-xs text-muted mt-1"},"Provide a clear, detailed description (max 2000 characters).",-1))]),_:1}),m(i,{label:"Priority",name:"priority"},{default:A(()=>[m(N,{modelValue:r.priority,"onUpdate:modelValue":a[2]||(a[2]=n=>r.priority=n),items:S.value,placeholder:"Select priority"},null,8,["modelValue","items"])]),_:1}),m(i,{label:"Category",name:"category_id",class:"sm:col-span-2"},{default:A(()=>[s("div",Me,[m(V,{value:h.value,placeholder:"Search categories by name",onInput:O,"aria-label":"Search categories"},null,8,["value"]),B.value?(o(),p("div",$e,"Searching...")):q("",!0),f.value.length?(o(),p("ul",Fe,[(o(!0),p(ie,null,se(f.value,n=>(o(),p("li",{key:n.id||n.value,class:"px-3 py-2 hover:bg-gray-100 cursor-pointer",onClick:C=>v(n)},R(n.name||n.title||n.label||n.value),9,Ne))),128))])):h.value.length>=2&&!B.value?(o(),p("div",Re,"No matching category")):q("",!0),x.value?(o(),p("div",je,[s("button",{type:"button",class:"text-xs text-muted hover:text-gray-700",onClick:y},"Clear")])):q("",!0)]),s("p",Pe,[a[5]||(a[5]=H("Choose a category for the ticket. Selected: ",-1)),s("span",Le,R(I.value||(r.category_id?r.category_id:"none")),1)])]),_:1}),m(i,{label:"Attachments",name:"attachments",class:"sm:col-span-2"},{default:A(()=>[s("div",{class:U(["border-2 border-dashed rounded-md p-6 min-h-28 text-center transition-colors cursor-pointer",z.value?"border-primary bg-primary/10":"border-gray-300 bg-gray-50"]),onDragover:M,onDragleave:L,onDrop:K,onClick:a[3]||(a[3]=n=>t.$refs.fileInput.click())},[s("input",{ref:"fileInput",type:"file",multiple:"",class:"hidden",onChange:Y},null,544),a[6]||(a[6]=s("div",{class:"flex flex-col items-center gap-2"},[s("span",{class:"i-lucide-upload-cloud text-3xl text-primary"}),s("span",{class:"font-medium"},[H("Drag & drop files here or "),s("span",{class:"underline text-primary cursor-pointer"},"browse")]),s("span",{class:"text-xs text-muted"},"Max 10MB.")],-1))],34),k.value?(o(),p("div",Oe,R(k.value),1)):q("",!0),a[8]||(a[8]=s("div",{class:"text-xs text-muted mt-2"},"You can attach images or PDFs. Max 10MB per file.",-1)),l.value.length?(o(),p("div",Ee,[s("ul",Ge,[(o(!0),p(ie,null,se(l.value,(n,C)=>(o(),p("li",{key:n.name,class:"flex flex-col gap-2 px-3 py-2"},[s("div",He,[a[7]||(a[7]=s("span",{class:"i-lucide-file text-lg text-gray-400"},null,-1)),s("span",Ye,R(n.name),1),s("span",Ke,"("+R((n.size/1024/1024).toFixed(2))+" MB)",1)]),d.value[C]?.type==="image"?(o(),p("div",We,[s("img",{src:d.value[C].url,alt:n.name,class:"max-h-24 rounded border"},null,8,Je)])):d.value[C]?.type==="pdf"?(o(),p("div",Qe,[s("embed",{src:d.value[C].url,type:"application/pdf",class:"max-h-32 w-full border rounded"},null,8,Xe)])):d.value[C]?.type==="other"?(o(),p("div",Ze," No preview available ")):q("",!0)]))),128))])])):q("",!0)]),_:1})]),s("div",et,[m(G,{color:"neutral",variant:"ghost",to:"/admin/categories"},{default:A(()=>[...a[9]||(a[9]=[H("Cancel",-1)])]),_:1}),m(G,{loading:e.value,disabled:e.value,type:"submit",color:"primary",icon:"i-lucide-check"},{default:A(()=>[...a[10]||(a[10]=[H("Create",-1)])]),_:1},8,["loading","disabled"])])],32)])]),_:1})]),_:1})}}});export{ut as default};
