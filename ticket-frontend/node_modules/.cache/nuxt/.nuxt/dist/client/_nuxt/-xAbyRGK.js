import{s as Y,_ as tt,a as et,b as st,c as at}from"./Ddr_hDuZ.js";import{_ as nt}from"./CFZJElYW.js";import{a0 as ot}from"./GPD3P-m0.js";import{_ as it}from"./RuDiqTgZ.js";import{_ as rt}from"./3Xv3klxV.js";import{_ as lt,u as ct}from"./qEMXtAZA.js";import{g as dt}from"./B6rNHc4N.js";import{b as ut}from"./BbY_nosd.js";import{g as pt,a3 as mt,e as y,z as I,P as _t,$ as V,h as ht,j as vt,a5 as xt,a1 as gt,k as E,w as m,a2 as U,o as u,b as r,a as s,p as M,f as n,c as h,F as S,t as l,d as C,q as yt}from"./BGim2kwq.js";import{u as G}from"./RmwAmyau.js";import"./kDLvYEi9.js";import"./CCraGg39.js";import"./K8s1tnq0.js";import"./D3QffkNq.js";const ft={class:"flex flex-col flex-1 gap-6 p-6 overflow-auto"},bt={class:"flex items-center justify-between gap-3"},kt={class:"space-y-1"},wt={class:"text-base font-medium text-gray-900"},$t={class:"space-y-1"},Tt={class:"space-y-1"},It={class:"text-base text-gray-900 font-mono"},Ut={class:"space-y-1"},St={class:"text-base text-gray-900"},Ct={class:"space-y-1"},Dt={class:"text-base text-gray-900"},Pt={class:"space-y-1"},Wt={class:"text-base text-gray-900"},Bt={class:"space-y-1 sm:col-span-2"},Ft={class:"text-base text-gray-900 whitespace-pre-line"},Nt={key:0,class:"space-y-1 sm:col-span-2"},jt={class:"flex flex-wrap gap-4"},At=["src","alt"],Vt=["src"],Et={key:2,class:"i-lucide-file text-3xl text-gray-400 mb-2"},Mt=["href"],Gt={class:"space-y-1"},zt={class:"text-base font-medium text-gray-900"},Ht={class:"text-base text-gray-900"},Rt={class:"text-base text-gray-900"},qt={class:"space-y-1"},Lt={class:"text-base text-gray-900"},Ot={class:"space-y-1 sm:col-span-2"},Zt={class:"text-base text-gray-900 whitespace-pre-line"},Jt={class:"sm:col-span-2 flex justify-end gap-3 pt-2"},me=pt({__name:"[id]",async setup(Kt){let _,f;const z=mt(),v=y(()=>z.params.id),x=I(!1),g=I(!1),i=_t({status:"",priority:"",technicianId:""}),H=["open","in_progress","pending","resolved","closed"],{data:e,status:R,refresh:D,error:P}=([_,f]=V(()=>G(()=>dt(v.value),{watch:[v],server:!1},"$F2AhWPBvoZ")),_=await _,f(),_),{data:W,error:Qt,status:Xt}=([_,f]=V(()=>G("technicians",()=>ut(),{server:!1,lazy:!0,default:()=>[]})),_=await _,f(),_);y(()=>(W.value||[]).map(a=>({label:a.username||a.email||`Tech #${a.id}`,value:String(a.id)})));const q=a=>{const t=a?.url||a?.path||a?.file_path||a?.attachment_url||a?.location;if(!t)return"";if(/^https?:\/\//i.test(t))return t;const c=window.location.origin.replace(/\/+$/,""),d=String(t).replace(/^\/+/,"");return d.startsWith("storage/")?`${c}/${d}`:d.startsWith("attachments/")?`${c}/storage/${d}`:d.startsWith("storage\\")?`${c}/${d.replace("\\","/")}`:`${c}/${d}`},B=y(()=>(e.value?.attachments||e.value?.files||e.value?.attachments?.data||e.value?.media||e.value?.documents||[]||[]).map(t=>({url:q(t),name:t?.name||t?.filename||t?.original_name||t?.file_name||t?.display_name||t?.path||t?.url||"File",type:t?.mime_type||t?.type||""})).filter(t=>t.url)),F=y(()=>{if(!e.value)return null;const a=e.value.assigned_tech_id||e.value.technician_id;return a?(W.value||[]).find(t=>t.id==a):null}),N=y(()=>F.value?.username||F.value?.email||e.value?.technician?.username||e.value?.technician?.name||e.value?.technician_name||"Unassigned"),w=I("");let $=null;const j=()=>{if(!e.value?.created_at)return;const a=new Date(e.value.created_at).getTime(),c=new Date().getTime()-a;if(c<0){w.value="0s";return}const d=Math.floor(c/(1e3*60*60*24)),b=Math.floor(c%(1e3*60*60*24)/(1e3*60*60)),k=Math.floor(c%(1e3*60*60)/(1e3*60)),T=Math.floor(c%(1e3*60)/1e3),p=[];d>0&&p.push(`${d}d`),b>0&&p.push(`${b}h`),k>0&&p.push(`${k}m`),p.push(`${T}s`),w.value=p.join(" ")};ht(()=>{j(),$=Y(j,1e3)}),vt(()=>{$&&clearInterval($)}),xt(()=>{if(e.value){i.status=e.value.status||"",i.priority=e.value.priority||"";const a=e.value.assigned_tech_id||e.value.technician_id||e.value.technicianId||e.value.technician?.id;i.technicianId=a?String(a):""}});const L=()=>{if(x.value=!x.value,!x.value&&e.value){i.status=e.value.status||"",i.priority=e.value.priority||"";const a=e.value.assigned_tech_id||e.value.technician_id||e.value.technicianId||e.value.technician?.id;i.technicianId=a?String(a):""}},O=async()=>{if(!(g.value||!v.value)){g.value=!0;try{const a={status:i.status||void 0,priority:i.priority||void 0,assigned_tech_id:i.technicianId?Number(i.technicianId):void 0};await ct(v.value,i.status),await D(),x.value=!1}catch(a){console.error("Failed to update ticket",a)}finally{g.value=!1}}};return gt(()=>{D()}),(a,t)=>{const c=et,d=st,b=U("UDashboardPageHeader"),k=at,T=nt,p=U("UFormGroup"),A=ot,Z=it,J=rt,K=lt,Q=U("UDashboardPage"),X=tt;return u(),E(X,null,{default:m(()=>[r(c),r(Q,{class:"flex flex-col flex-1 min-w-0 overflow-hidden"},{default:m(()=>[r(d,{title:"Ticket",icon:"i-lucide-ticket",class:"w-full"}),s("div",ft,[s("div",bt,[r(b,{title:n(e)?`Ticket #${n(e).id}`:"Ticket",description:n(e)?.title||"Ticket details"},null,8,["title","description"])]),r(Z,{ui:{body:"grid gap-4 sm:grid-cols-2"},loading:n(R)==="pending"},{default:m(()=>[n(x)?(u(),h(S,{key:1},[s("div",Gt,[t[9]||(t[9]=s("p",{class:"text-xs text-muted-500"},"Title",-1)),s("p",zt,l(n(e)?.title||"-"),1)]),r(p,{label:"Status",name:"status"},{default:m(()=>[r(T,{modelValue:n(i).status,"onUpdate:modelValue":t[0]||(t[0]=o=>n(i).status=o),items:H,placeholder:"Select status"},null,8,["modelValue"])]),_:1}),r(p,{label:"Priority",name:"priority"},{default:m(()=>[s("p",Ht,l(n(e)?.priority||"-"),1)]),_:1}),r(p,{label:"Assign technician",name:"technician"},{default:m(()=>[s("p",Rt,l(n(N)),1)]),_:1}),s("div",qt,[t[10]||(t[10]=s("p",{class:"text-xs text-muted-500"},"Category",-1)),s("p",Lt,l(n(e)?.category?.name||"-"),1)]),s("div",Ot,[t[11]||(t[11]=s("p",{class:"text-xs text-muted-500"},"Description",-1)),s("p",Zt,l(n(e)?.description||"-"),1)]),s("div",Jt,[r(A,{type:"button",color:"neutral",variant:"ghost",onClick:L},{default:m(()=>[...t[12]||(t[12]=[C("Cancel",-1)])]),_:1}),r(A,{type:"button",color:"primary",icon:"i-lucide-check",loading:n(g),disabled:n(g),onClick:O},{default:m(()=>[...t[13]||(t[13]=[C(" Save Changes ",-1)])]),_:1},8,["loading","disabled"])])],64)):(u(),h(S,{key:0},[s("div",kt,[t[1]||(t[1]=s("p",{class:"text-xs text-muted-500"},"Title",-1)),s("p",wt,l(n(e)?.title||"-"),1)]),s("div",$t,[t[2]||(t[2]=s("p",{class:"text-xs text-muted-500"},"Status",-1)),r(k,{color:"primary",variant:"soft"},{default:m(()=>[C(l(n(e)?.status||"-"),1)]),_:1})]),s("div",Tt,[t[3]||(t[3]=s("p",{class:"text-xs text-muted-500"},"Time Elapsed",-1)),s("p",It,l(n(w)),1)]),s("div",Ut,[t[4]||(t[4]=s("p",{class:"text-xs text-muted-500"},"Priority",-1)),s("p",St,l(n(e)?.priority||"-"),1)]),s("div",Ct,[t[5]||(t[5]=s("p",{class:"text-xs text-muted-500"},"Technician",-1)),s("p",Dt,l(n(N)),1)]),s("div",Pt,[t[6]||(t[6]=s("p",{class:"text-xs text-muted-500"},"Category",-1)),s("p",Wt,l(n(e)?.category?.name||"-"),1)]),s("div",Bt,[t[7]||(t[7]=s("p",{class:"text-xs text-muted-500"},"Description",-1)),s("p",Ft,l(n(e)?.description||"-"),1)]),n(B).length?(u(),h("div",Nt,[t[8]||(t[8]=s("p",{class:"text-xs text-muted-500"},"Attachments",-1)),s("div",jt,[(u(!0),h(S,null,yt(n(B),o=>(u(),h("div",{key:o.url||o.name,class:"flex flex-col items-center w-32"},[o.url&&(o.url.endsWith(".png")||o.url.endsWith(".jpg")||o.url.endsWith(".jpeg")||o.url.endsWith(".gif"))?(u(),h("img",{key:0,src:o.url,alt:o.name,class:"w-28 h-28 object-cover rounded border"},null,8,At)):o.url&&o.url.endsWith(".pdf")?(u(),h("embed",{key:1,src:o.url,type:"application/pdf",class:"w-28 h-28 border rounded"},null,8,Vt)):(u(),h("span",Et)),s("a",{href:o.url,target:"_blank",class:"text-xs text-primary underline mt-1 break-all"},l(o.name||o.url),9,Mt)]))),128))])])):M("",!0)],64))]),_:1},8,["loading"]),n(P)?(u(),E(J,{key:0,icon:"i-lucide-alert-triangle",color:"red",variant:"soft",title:"Unable to load ticket",description:n(P)?.message||"Please try again."},null,8,["description"])):M("",!0)]),r(K,{ticketId:n(v)},null,8,["ticketId"])]),_:1})]),_:1})}}});export{me as default};
