import{_ as U,a as D,b as $}from"./Ddr_hDuZ.js";import{_ as N}from"./kDLvYEi9.js";import{_ as T}from"./CvGMUJgZ.js";import{Y as C,g as S,$ as f,e as y,a5 as H,a1 as K,k as g,o as A,w as p,b as l,d as P,t as j,f as B,_ as z,a2 as h,a as E}from"./BGim2kwq.js";import{a as I}from"./BbY_nosd.js";import{u as v}from"./RmwAmyau.js";import"./GPD3P-m0.js";import"./K8s1tnq0.js";import"./DYcZGXPK.js";const R=async(r={})=>{let n=C("auth_token").value||"";try{n=decodeURIComponent(n)}catch{}const a=new URLSearchParams;r.status&&a.append("status",r.status),r.priority&&a.append("priority",r.priority),r.category_id&&a.append("category_id",r.category_id),typeof r=="string"?a.append("name",r):r.name&&a.append("name",r.name);let c="http://localhost:8000/api/history/logs";const d=a.toString();d&&(c+=`?${d}`);const i=await fetch(c,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${n}`}}),e=await i.json();if(!i.ok)throw e;return e?.data?.data&&Array.isArray(e.data.data)?e.data.data:Array.isArray(e)?e:Array.isArray(e.data)?e.data:Array.isArray(e.tickets)?e.tickets:[]},V=S({__name:"historyTable",async setup(r){let o,n;const{data:a,status:c,error:d,refresh:i}=([o,n]=f(()=>v("history-list",()=>R(),{server:!1,lazy:!1})),o=await o,n(),o),e=y(()=>a.value?Array.isArray(a.value)?a.value:a.value.data&&Array.isArray(a.value.data)?a.value.data:a.value.data&&a.value.data.data&&Array.isArray(a.value.data.data)?a.value.data.data:[]:[]),{data:u}=([o,n]=f(()=>v("all-users",()=>I(),{server:!1,lazy:!1})),o=await o,n(),o),x=y(()=>{const _={};return(u.value&&(Array.isArray(u.value)?u.value:u.value.data)||[]||[]).forEach(t=>{t&&t.id!=null&&(_[String(t.id)]=t.username||t.name||t.email||`User ${t.id}`)}),_}),b=_=>{const s=_?.original||{},t=s.actor_id||s.user_id||s.causer_id||s.actor&&s.actor.id||s.causer&&s.causer.id;return t!=null?x.value[String(t)]||`User ${t}`:s.actor_username||s.causer_username||s.username||"Unknown"};H(()=>{a.value,u.value});const w=[{accessorKey:"id",header:"ID"},{accessorKey:"ticket_id",header:"Ticket ID"},{accessorKey:"action",header:"Action"},{accessorKey:"actor_username",header:"Actor Username"},{accessorKey:"notes",header:"Notes"}];return K(()=>{i()}),(_,s)=>{const t=N,k=T;return A(),g(k,{data:e.value,columns:w,loading:B(c)==="pending",class:"flex-1"},{"actor_username-cell":p(({row:m})=>[l(t,{to:`/admin/users/${m.original.id}`,class:"text-primary underline hover:text-primary-600"},{default:p(()=>[P(j(b(m)),1)]),_:2},1032,["to"])]),_:1},8,["data","loading"])}}}),G=Object.assign(V,{__name:"HistoryTable"}),L={},q={class:"flex flex-col flex-1 gap-6 p-6 overflow-auto"};function M(r,o){const n=D,a=$,c=h("UDashboardPageHeader"),d=G,i=h("UDashboardPage"),e=U;return A(),g(e,null,{default:p(()=>[l(n),l(i,{class:"flex flex-col flex-1 min-w-0 overflow-hidden"},{default:p(()=>[l(a,{title:"Dashboard",icon:"i-lucide-house",class:"w-full"}),E("div",q,[l(c,{title:"Dashboard",description:"Welcome to your dashboard."}),l(d,{class:"flex-1 w-full"})])]),_:1})]),_:1})}const ea=z(L,[["render",M]]);export{ea as default};
