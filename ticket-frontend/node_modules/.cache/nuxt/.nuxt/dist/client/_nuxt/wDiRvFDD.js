import{_ as Y,a as K,b as Q}from"./Ddr_hDuZ.js";import{a0 as W}from"./GPD3P-m0.js";import{_ as X}from"./D3QffkNq.js";import{_ as Z}from"./CFZJElYW.js";import{_ as ee}from"./RuDiqTgZ.js";import{Y as $,g as te,a3 as ae,a4 as oe,e as se,z as A,P as le,$ as ne,h as B,a5 as D,k as R,w as i,a2 as E,o as h,b as n,a as l,f,p as S,d as _,t as b,c as j,v as re}from"./BGim2kwq.js";import{g as ie}from"./BbY_nosd.js";import{u as de}from"./RmwAmyau.js";import"./kDLvYEi9.js";import"./K8s1tnq0.js";import"./CCraGg39.js";const ue=async(d,{username:c,email:r,password:m,role:o,department:a})=>{let t=$("auth_token").value||"";try{t=decodeURIComponent(t)}catch{}const k=await fetch(`http://localhost:8000/api/users/${d}`,{method:"PUT",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({username:c,email:r,password:m,role:o,department:a})}),s=await k.json();if(!k.ok)throw s;return s?.data||s},ce=async d=>{if(!d)throw new Error("User id is required");let r=$("auth_token").value||"";try{r=decodeURIComponent(r)}catch{}const m=`http://localhost:8000/api/users/${encodeURIComponent(d)}/activate`,o=await fetch(m,{method:"PATCH",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${r}`}}),a=await o.json();if(!o.ok)throw a;return a?.data??a},me=async d=>{if(!d)throw new Error("User id is required");let r=$("auth_token").value||"";try{r=decodeURIComponent(r)}catch{}const m=`http://localhost:8000/api/users/${encodeURIComponent(d)}/deactivate`,o=await fetch(m,{method:"PATCH",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${r}`}}),a=await o.json();if(!o.ok)throw a;return a?.data??a},pe=async d=>{if(!d)throw new Error("User id is required");let r=$("auth_token").value||"";try{r=decodeURIComponent(r)}catch{}const m=`http://localhost:8000/api/users/${encodeURIComponent(d)}/account-status`,o=await fetch(m,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${r}`}}),a=await o.json();if(!o.ok)throw a;return a?.data??a},fe={class:"flex flex-col flex-1 gap-6 p-6 overflow-auto"},ve={class:"flex items-center justify-between gap-3"},he={class:"flex gap-2"},_e={class:"flex items-center justify-between"},ge={key:0,class:"text-xs text-muted"},we={key:0,class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},xe={class:"text-sm text-highlighted"},ye={class:"text-sm text-highlighted"},be={class:"text-sm text-highlighted"},ke={class:"text-sm text-highlighted"},Ue={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},Ce={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},Ve={class:"flex justify-end gap-3 pt-2"},Ae={key:2,class:"mt-4 text-sm text-error"},je={class:"flex gap-3"},Ne=te({__name:"[id]",async setup(d){let c,r;const m=ae();oe();const o=se(()=>m.params.id),a=A(!1),g=A(!1),t=le({username:"",email:"",password:"",role:"",department:""}),k=["user","technician","supervisor","admin"],{data:s,status:P,error:T,refresh:w}=([c,r]=ne(()=>de(()=>`user-${o.value}`,()=>ie(o.value),{server:!1,lazy:!1,immediate:!0,watch:[o]})),c=await c,r(),c);B(()=>w());const U=A(null),x=A(!1),C=async()=>{if(o.value)try{const u=await pe(o.value);U.value=u?.is_active??null}catch(u){console.error("Failed to load account status",u),U.value=null}};B(()=>{w(),C()}),D(()=>{s.value&&C()});const F=async()=>{if(o.value){x.value=!0;try{await ce(o.value),await w(),await C()}catch(u){console.error("Failed to activate account",u)}finally{x.value=!1}}},I=async()=>{if(o.value){x.value=!0;try{await me(o.value),await w(),await C()}catch(u){console.error("Failed to deactivate account",u)}finally{x.value=!1}}};D(()=>{s.value&&(t.username=s.value.username||"",t.email=s.value.email||"",t.role=s.value.role||"",t.department=s.value.department||"")});const z=()=>{a.value=!a.value,a.value||s.value&&(t.username=s.value.username||"",t.email=s.value.email||"",t.role=s.value.role||"",t.department=s.value.department||"",t.password="")},N=async()=>{if(!g.value){g.value=!0;try{await ue(o.value,{username:t.username,email:t.email,password:t.password||void 0,role:t.role||void 0,department:t.department||void 0}),await w(),a.value=!1,t.password=""}catch(u){console.error("Failed to update user",u)}finally{g.value=!1}}};return(u,e)=>{const q=K,G=Q,H=E("UDashboardPageHeader"),v=W,V=X,y=E("UFormGroup"),L=Z,M=ee,J=E("UDashboardPage"),O=Y;return h(),R(O,null,{default:i(()=>[n(q),n(J,{class:"flex flex-col flex-1 min-w-0 overflow-hidden"},{default:i(()=>[n(G,{title:"User details",icon:"i-lucide-user",class:"w-full"}),l("div",fe,[l("div",ve,[n(H,{title:f(s)?.username||"User",description:f(s)?.email||""},null,8,["title","description"]),l("div",he,[n(v,{size:"sm",icon:a.value?"i-lucide-x":"i-lucide-pencil",color:a.value?"neutral":"primary",onClick:z},{default:i(()=>[_(b(a.value?"Cancel":"Edit"),1)]),_:1},8,["icon","color"]),U.value===!0?(h(),R(v,{key:0,size:"sm",loading:x.value,onClick:I,class:"bg-red-600 hover:bg-red-700 text-white font-semibold px-3 py-1 rounded"},{default:i(()=>[...e[5]||(e[5]=[_(" Deactivate ",-1)])]),_:1},8,["loading"])):U.value===!1?(h(),R(v,{key:1,size:"sm",loading:x.value,onClick:F,class:"bg-blue-600 hover:bg-blue-700 text-white font-semibold px-3 py-1 rounded"},{default:i(()=>[...e[6]||(e[6]=[_(" Activate ",-1)])]),_:1},8,["loading"])):S("",!0)])]),n(M,null,{header:i(()=>[l("div",_e,[e[7]||(e[7]=l("p",{class:"text-sm font-semibold text-highlighted"},"Profile",-1)),f(P)==="pending"?(h(),j("div",ge,"Loading...")):S("",!0)])]),default:i(()=>[a.value?(h(),j("form",{key:1,class:"flex flex-col gap-4",onSubmit:re(N,["prevent"])},[l("div",Ue,[n(y,{label:"Username",name:"username"},{default:i(()=>[n(V,{modelValue:t.username,"onUpdate:modelValue":e[0]||(e[0]=p=>t.username=p),required:"",maxlength:"255"},null,8,["modelValue"])]),_:1}),n(y,{label:"Email",name:"email"},{default:i(()=>[n(V,{modelValue:t.email,"onUpdate:modelValue":e[1]||(e[1]=p=>t.email=p),type:"email",required:"",maxlength:"255"},null,8,["modelValue"])]),_:1})]),n(y,{label:"Password (leave blank to keep current)",name:"password"},{default:i(()=>[n(V,{modelValue:t.password,"onUpdate:modelValue":e[2]||(e[2]=p=>t.password=p),type:"password",minlength:"8"},null,8,["modelValue"])]),_:1}),l("div",Ce,[n(y,{label:"Role",name:"role"},{default:i(()=>[n(L,{modelValue:t.role,"onUpdate:modelValue":e[3]||(e[3]=p=>t.role=p),items:k,placeholder:"Select role"},null,8,["modelValue"])]),_:1}),n(y,{label:"Department",name:"department"},{default:i(()=>[n(V,{modelValue:t.department,"onUpdate:modelValue":e[4]||(e[4]=p=>t.department=p),maxlength:"255"},null,8,["modelValue"])]),_:1})]),l("div",Ve,[n(v,{type:"button",color:"neutral",variant:"ghost",onClick:z},{default:i(()=>[...e[12]||(e[12]=[_("Cancel",-1)])]),_:1}),n(v,{type:"submit",color:"primary",icon:"i-lucide-check",loading:g.value,disabled:g.value},{default:i(()=>[...e[13]||(e[13]=[_(" Save Changes ",-1)])]),_:1},8,["loading","disabled"])])],32)):(h(),j("div",we,[l("div",null,[e[8]||(e[8]=l("p",{class:"text-xs text-muted"},"Username",-1)),l("p",xe,b(f(s)?.username||"—"),1)]),l("div",null,[e[9]||(e[9]=l("p",{class:"text-xs text-muted"},"Email",-1)),l("p",ye,b(f(s)?.email||"—"),1)]),l("div",null,[e[10]||(e[10]=l("p",{class:"text-xs text-muted"},"Role",-1)),l("p",be,b(f(s)?.role||"—"),1)]),l("div",null,[e[11]||(e[11]=l("p",{class:"text-xs text-muted"},"Department",-1)),l("p",ke,b(f(s)?.department||"—"),1)])])),f(T)?(h(),j("div",Ae,"Failed to load user.")):S("",!0)]),_:1}),l("div",je,[n(v,{color:"neutral",variant:"ghost",to:"/admin/users"},{default:i(()=>[...e[14]||(e[14]=[_("Back to list",-1)])]),_:1}),n(v,{size:"sm",icon:"i-lucide-refresh-ccw",variant:"outline",onClick:f(w)},{default:i(()=>[...e[15]||(e[15]=[_("Refresh",-1)])]),_:1},8,["onClick"])])])]),_:1})]),_:1})}}});export{Ne as default};
