import { _ as _sfc_main$e, a as __nuxt_component_1, b as __nuxt_component_2, c as _sfc_main$6$1 } from './navbar-DByaTdfk.mjs';
import { defineComponent, resolveComponent, withCtx, createVNode, ref, mergeProps, withModifiers, createBlock, openBlock, toDisplayString, createCommentVNode, createTextVNode, useSSRContext } from 'file:///home/mkobaa/workspace/HelpDeskApp/ticket-frontend/node_modules/vue/index.mjs';
import { ssrRenderComponent, ssrRenderAttrs, ssrInterpolate, ssrRenderList, ssrRenderAttr, ssrRenderClass } from 'file:///home/mkobaa/workspace/HelpDeskApp/ticket-frontend/node_modules/vue/server-renderer/index.mjs';
import { _ as _sfc_main$6 } from './Card-o7xn3WFg.mjs';
import { d as useRoute, e as useRouter, b as useCookie } from './server.mjs';
import { b as _sfc_main$7 } from './usePortal-BKdXuyUd.mjs';
import 'file:///home/mkobaa/workspace/HelpDeskApp/ticket-frontend/node_modules/reka-ui/dist/index.js';
import 'file:///home/mkobaa/workspace/HelpDeskApp/ticket-frontend/node_modules/defu/dist/defu.mjs';
import 'file:///home/mkobaa/workspace/HelpDeskApp/ticket-frontend/node_modules/@vueuse/core/dist/index.js';
import 'file:///home/mkobaa/workspace/HelpDeskApp/ticket-frontend/node_modules/vaul-vue/dist/index.js';
import 'file:///home/mkobaa/workspace/HelpDeskApp/ticket-frontend/node_modules/reka-ui/dist/namespaced/index.mjs';
import './nuxt-link-Bj7IzWuU.mjs';
import 'file:///home/mkobaa/workspace/HelpDeskApp/ticket-frontend/node_modules/ufo/dist/index.mjs';
import 'file:///home/mkobaa/workspace/HelpDeskApp/ticket-frontend/node_modules/ofetch/dist/node.mjs';
import '../nitro/nitro.mjs';
import 'file:///home/mkobaa/workspace/HelpDeskApp/ticket-frontend/node_modules/h3/dist/index.mjs';
import 'file:///home/mkobaa/workspace/HelpDeskApp/ticket-frontend/node_modules/destr/dist/index.mjs';
import 'file:///home/mkobaa/workspace/HelpDeskApp/ticket-frontend/node_modules/hookable/dist/index.mjs';
import 'file:///home/mkobaa/workspace/HelpDeskApp/ticket-frontend/node_modules/node-mock-http/dist/index.mjs';
import 'file:///home/mkobaa/workspace/HelpDeskApp/ticket-frontend/node_modules/unstorage/dist/index.mjs';
import 'file:///home/mkobaa/workspace/HelpDeskApp/ticket-frontend/node_modules/unstorage/drivers/fs.mjs';
import 'node:crypto';
import 'file:///home/mkobaa/workspace/HelpDeskApp/ticket-frontend/node_modules/unstorage/drivers/fs-lite.mjs';
import 'file:///home/mkobaa/workspace/HelpDeskApp/ticket-frontend/node_modules/unstorage/drivers/lru-cache.mjs';
import 'file:///home/mkobaa/workspace/HelpDeskApp/ticket-frontend/node_modules/ohash/dist/index.mjs';
import 'file:///home/mkobaa/workspace/HelpDeskApp/ticket-frontend/node_modules/klona/dist/index.mjs';
import 'file:///home/mkobaa/workspace/HelpDeskApp/ticket-frontend/node_modules/scule/dist/index.mjs';
import 'file:///home/mkobaa/workspace/HelpDeskApp/ticket-frontend/node_modules/unctx/dist/index.mjs';
import 'file:///home/mkobaa/workspace/HelpDeskApp/ticket-frontend/node_modules/radix3/dist/index.mjs';
import 'node:fs';
import 'node:url';
import 'file:///home/mkobaa/workspace/HelpDeskApp/ticket-frontend/node_modules/pathe/dist/index.mjs';
import 'file:///home/mkobaa/workspace/HelpDeskApp/ticket-frontend/node_modules/@iconify/utils/lib/index.js';
import 'file:///home/mkobaa/workspace/HelpDeskApp/ticket-frontend/node_modules/consola/dist/index.mjs';
import 'file:///home/mkobaa/workspace/HelpDeskApp/ticket-frontend/node_modules/vue-router/vue-router.node.mjs';
import 'file:///home/mkobaa/workspace/HelpDeskApp/ticket-frontend/node_modules/nuxt/node_modules/cookie-es/dist/index.mjs';
import 'file:///home/mkobaa/workspace/HelpDeskApp/ticket-frontend/node_modules/tailwindcss/dist/colors.mjs';
import 'file:///home/mkobaa/workspace/HelpDeskApp/ticket-frontend/node_modules/@iconify/vue/dist/iconify.mjs';
import '../_/renderer.mjs';
import 'file:///home/mkobaa/workspace/HelpDeskApp/ticket-frontend/node_modules/vue-bundle-renderer/dist/runtime.mjs';
import 'file:///home/mkobaa/workspace/HelpDeskApp/ticket-frontend/node_modules/unhead/dist/server.mjs';
import 'file:///home/mkobaa/workspace/HelpDeskApp/ticket-frontend/node_modules/devalue/index.js';
import 'file:///home/mkobaa/workspace/HelpDeskApp/ticket-frontend/node_modules/unhead/dist/utils.mjs';
import 'file:///home/mkobaa/workspace/HelpDeskApp/ticket-frontend/node_modules/ohash/dist/utils/index.mjs';
import 'file:///home/mkobaa/workspace/HelpDeskApp/ticket-frontend/node_modules/tailwind-variants/dist/index.js';
import './index-Db0gMLsE.mjs';
import 'file:///home/mkobaa/workspace/HelpDeskApp/ticket-frontend/node_modules/@iconify/utils/lib/css/icon.js';
import 'file:///home/mkobaa/workspace/HelpDeskApp/ticket-frontend/node_modules/perfect-debounce/dist/index.mjs';

const _sfc_main$5 = /* @__PURE__ */ defineComponent({
  __name: "Ratings",
  __ssrInlineRender: true,
  props: { label: { type: String, default: "" }, modelValue: { type: Number, default: 5 } },
  emits: ["update:modelValue"],
  setup(__props, { emit: __emit }) {
    const labels = ["Poor", "Fair", "Good", "Very Good", "Excellent"];
    return (_ctx, _push, _parent, _attrs) => {
      _push(`<div${ssrRenderAttrs(_attrs)}><p class="text-sm font-semibold text-gray-700 mb-1">${ssrInterpolate(__props.label)}</p><div class="flex gap-3"><!--[-->`);
      ssrRenderList(5, (n) => {
        _push(`<button type="button"${ssrRenderAttr("aria-pressed", __props.modelValue === n)} class="${ssrRenderClass([
          "w-24 h-12 flex flex-col items-center justify-center rounded-md text-sm font-medium transition-colors",
          __props.modelValue === n ? "border border-sky-600 bg-sky-50 text-sky-700" : "border border-transparent bg-white text-gray-800 hover:border-gray-200"
        ])}"><span class="text-lg font-semibold">${ssrInterpolate(n)}</span><span class="text-xs text-muted-500">${ssrInterpolate(labels[n - 1])}</span></button>`);
      });
      _push(`<!--]--></div></div>`);
    };
  }
});
const _sfc_setup$5 = _sfc_main$5.setup;
_sfc_main$5.setup = (props, ctx) => {
  const ssrContext = useSSRContext();
  (ssrContext.modules || (ssrContext.modules = /* @__PURE__ */ new Set())).add("components/survey/Ratings.vue");
  return _sfc_setup$5 ? _sfc_setup$5(props, ctx) : void 0;
};
const Ratings = Object.assign(_sfc_main$5, { __name: "SurveyRatings" });
const _sfc_main$4 = /* @__PURE__ */ defineComponent({
  __name: "Comments",
  __ssrInlineRender: true,
  props: { modelValue: { type: String, default: "" }, maxLength: { type: Number, default: 1e3 } },
  emits: ["update:modelValue"],
  setup(__props, { emit: __emit }) {
    return (_ctx, _push, _parent, _attrs) => {
      _push(`<div${ssrRenderAttrs(_attrs)}><label class="text-sm font-semibold text-gray-700">Comments (optional)</label><textarea${ssrRenderAttr("rows", 4)} class="form-textarea w-full mt-1" placeholder="Anything else you&#39;d like to tell us?">${ssrInterpolate(__props.modelValue)}</textarea><div class="text-xs text-muted-500 mt-1">Optional — helpful for context (max ${ssrInterpolate(__props.maxLength)} chars).</div></div>`);
    };
  }
});
const _sfc_setup$4 = _sfc_main$4.setup;
_sfc_main$4.setup = (props, ctx) => {
  const ssrContext = useSSRContext();
  (ssrContext.modules || (ssrContext.modules = /* @__PURE__ */ new Set())).add("components/survey/Comments.vue");
  return _sfc_setup$4 ? _sfc_setup$4(props, ctx) : void 0;
};
const Comments = Object.assign(_sfc_main$4, { __name: "SurveyComments" });
const _sfc_main$3 = /* @__PURE__ */ defineComponent({
  __name: "SubmitButtons",
  __ssrInlineRender: true,
  props: { loading: { type: Boolean, default: false } },
  emits: ["submit", "cancel"],
  setup(__props, { emit: __emit }) {
    return (_ctx, _push, _parent, _attrs) => {
      const _component_UButton = _sfc_main$7;
      _push(`<div${ssrRenderAttrs(mergeProps({ class: "flex items-center gap-3" }, _attrs))}>`);
      _push(ssrRenderComponent(_component_UButton, {
        loading: __props.loading,
        color: "primary",
        onClick: ($event) => _ctx.$emit("submit")
      }, {
        default: withCtx((_, _push2, _parent2, _scopeId) => {
          if (_push2) {
            _push2(`Submit feedback`);
          } else {
            return [
              createTextVNode("Submit feedback")
            ];
          }
        }),
        _: 1
      }, _parent));
      _push(ssrRenderComponent(_component_UButton, {
        color: "neutral",
        variant: "outline",
        onClick: ($event) => _ctx.$emit("cancel")
      }, {
        default: withCtx((_, _push2, _parent2, _scopeId) => {
          if (_push2) {
            _push2(`Cancel`);
          } else {
            return [
              createTextVNode("Cancel")
            ];
          }
        }),
        _: 1
      }, _parent));
      _push(`</div>`);
    };
  }
});
const _sfc_setup$3 = _sfc_main$3.setup;
_sfc_main$3.setup = (props, ctx) => {
  const ssrContext = useSSRContext();
  (ssrContext.modules || (ssrContext.modules = /* @__PURE__ */ new Set())).add("components/survey/SubmitButtons.vue");
  return _sfc_setup$3 ? _sfc_setup$3(props, ctx) : void 0;
};
const SubmitButtons = Object.assign(_sfc_main$3, { __name: "SurveySubmitButtons" });
const _sfc_main$2 = /* @__PURE__ */ defineComponent({
  __name: "SuccessBanner",
  __ssrInlineRender: true,
  props: { message: { type: String, default: "" } },
  setup(__props) {
    return (_ctx, _push, _parent, _attrs) => {
      const _component_UBadge = _sfc_main$6$1;
      if (__props.message) {
        _push(`<div${ssrRenderAttrs(mergeProps({ class: "my-2" }, _attrs))}>`);
        _push(ssrRenderComponent(_component_UBadge, {
          color: "emerald",
          variant: "soft"
        }, {
          default: withCtx((_, _push2, _parent2, _scopeId) => {
            if (_push2) {
              _push2(`${ssrInterpolate(__props.message)}`);
            } else {
              return [
                createTextVNode(toDisplayString(__props.message), 1)
              ];
            }
          }),
          _: 1
        }, _parent));
        _push(`</div>`);
      } else {
        _push(`<!---->`);
      }
    };
  }
});
const _sfc_setup$2 = _sfc_main$2.setup;
_sfc_main$2.setup = (props, ctx) => {
  const ssrContext = useSSRContext();
  (ssrContext.modules || (ssrContext.modules = /* @__PURE__ */ new Set())).add("components/survey/SuccessBanner.vue");
  return _sfc_setup$2 ? _sfc_setup$2(props, ctx) : void 0;
};
const SuccessBanner = Object.assign(_sfc_main$2, { __name: "SurveySuccessBanner" });
const _sfc_main$1 = /* @__PURE__ */ defineComponent({
  __name: "SurveyForm",
  __ssrInlineRender: true,
  setup(__props) {
    const route = useRoute();
    const router = useRouter();
    const ticketIdParam = route.params.id || "";
    const ticket = ref(null);
    const loadingTicket = ref(false);
    const formatDate = (val) => {
      if (!val) return "";
      const d = new Date(val);
      if (Number.isNaN(d.getTime())) return String(val);
      return d.toLocaleString();
    };
    const form = ref({
      ticket_id: ticketIdParam || "",
      satisfaction_rating: 5,
      response_time_rating: 5,
      resolution_quality_rating: 5,
      comments: ""
    });
    const errors = ref({});
    const submitting = ref(false);
    const successMessage = ref("");
    const validate = () => {
      errors.value = {};
      const between = (v) => Number(v) >= 1 && Number(v) <= 5;
      if (!between(form.value.satisfaction_rating)) errors.value.satisfaction_rating = "Required (1-5)";
      if (!between(form.value.response_time_rating)) errors.value.response_time_rating = "Required (1-5)";
      if (!between(form.value.resolution_quality_rating)) errors.value.resolution_quality_rating = "Required (1-5)";
      return Object.keys(errors.value).length === 0;
    };
    const submit = async () => {
      if (!validate()) return;
      submitting.value = true;
      try {
        const token = useCookie("auth_token");
        let bearer = token.value || "";
        try {
          bearer = decodeURIComponent(bearer);
        } catch {
        }
        const payload = {
          satisfaction_rating: Number(form.value.satisfaction_rating),
          response_time_rating: Number(form.value.response_time_rating),
          resolution_quality_rating: Number(form.value.resolution_quality_rating),
          comments: form.value.comments
        };
        const ticketId = ticket.value?.id || form.value.ticket_id || ticketIdParam;
        const url = `http://localhost:8000/api/tickets/${encodeURIComponent(ticketId)}/survey`;
        const res = await fetch(url, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${bearer}`
          },
          body: JSON.stringify(payload)
        });
        const raw = await res.json();
        if (!res.ok) throw raw;
        successMessage.value = "Thank you — your feedback has been submitted.";
        setTimeout(() => router.push("/user/tickets"), 1400);
      } catch (err) {
        console.error("submit survey", err);
        errors.value.form = err?.message || "Submission failed";
      } finally {
        submitting.value = false;
      }
    };
    return (_ctx, _push, _parent, _attrs) => {
      const _component_UCard = _sfc_main$6;
      _push(`<div${ssrRenderAttrs(mergeProps({ class: "space-y-6" }, _attrs))}><div class="flex items-center justify-between"><div><p class="text-sm text-muted-500">User</p><h2 class="text-lg font-semibold text-gray-900">Ticket Survey</h2><p class="text-sm text-muted-500">Please provide feedback for the selected ticket.</p></div>`);
      _push(ssrRenderComponent(SuccessBanner, { message: successMessage.value }, null, _parent));
      _push(`</div>`);
      _push(ssrRenderComponent(_component_UCard, null, {
        default: withCtx((_, _push2, _parent2, _scopeId) => {
          if (_push2) {
            _push2(`<form class="space-y-6"${_scopeId}><div${_scopeId}>`);
            if (loadingTicket.value) {
              _push2(`<div class="py-4"${_scopeId}>Loading ticket...</div>`);
            } else if (ticket.value) {
              _push2(`<div class="flex items-center justify-between"${_scopeId}><div${_scopeId}><p class="text-sm text-muted-500"${_scopeId}>Ticket</p><p class="text-base font-semibold"${_scopeId}>${ssrInterpolate(ticket.value.id)} - ${ssrInterpolate(ticket.value.title || ticket.value.subject)}</p><p class="text-sm text-muted-500"${_scopeId}>${ssrInterpolate(ticket.value.status)} • ${ssrInterpolate(formatDate(ticket.value.created_at))}</p></div><div class="text-sm text-muted-500"${_scopeId}>Ticket provided by system</div></div>`);
            } else {
              _push2(`<div class="text-sm text-red-600"${_scopeId}>Ticket information not available.</div>`);
            }
            _push2(`</div><div${_scopeId}><p class="text-sm font-semibold text-gray-700 mb-2"${_scopeId}>Ratings</p><div class="grid gap-4 sm:grid-cols-3"${_scopeId}>`);
            _push2(ssrRenderComponent(Ratings, {
              label: "Satisfaction",
              modelValue: form.value.satisfaction_rating,
              "onUpdate:modelValue": ($event) => form.value.satisfaction_rating = $event
            }, null, _parent2, _scopeId));
            _push2(ssrRenderComponent(Ratings, {
              label: "Response time",
              modelValue: form.value.response_time_rating,
              "onUpdate:modelValue": ($event) => form.value.response_time_rating = $event
            }, null, _parent2, _scopeId));
            _push2(ssrRenderComponent(Ratings, {
              label: "Resolution quality",
              modelValue: form.value.resolution_quality_rating,
              "onUpdate:modelValue": ($event) => form.value.resolution_quality_rating = $event
            }, null, _parent2, _scopeId));
            _push2(`</div></div>`);
            _push2(ssrRenderComponent(Comments, {
              modelValue: form.value.comments,
              "onUpdate:modelValue": ($event) => form.value.comments = $event,
              maxLength: 1e3
            }, null, _parent2, _scopeId));
            _push2(`<div${_scopeId}>`);
            if (errors.value.form) {
              _push2(`<div class="text-sm text-red-600 mb-2"${_scopeId}>${ssrInterpolate(errors.value.form)}</div>`);
            } else {
              _push2(`<!---->`);
            }
            _push2(ssrRenderComponent(SubmitButtons, {
              loading: submitting.value,
              onSubmit: submit,
              onCancel: ($event) => _ctx.$router.back()
            }, null, _parent2, _scopeId));
            _push2(`</div></form>`);
          } else {
            return [
              createVNode("form", {
                onSubmit: withModifiers(submit, ["prevent"]),
                class: "space-y-6"
              }, [
                createVNode("div", null, [
                  loadingTicket.value ? (openBlock(), createBlock("div", {
                    key: 0,
                    class: "py-4"
                  }, "Loading ticket...")) : ticket.value ? (openBlock(), createBlock("div", {
                    key: 1,
                    class: "flex items-center justify-between"
                  }, [
                    createVNode("div", null, [
                      createVNode("p", { class: "text-sm text-muted-500" }, "Ticket"),
                      createVNode("p", { class: "text-base font-semibold" }, toDisplayString(ticket.value.id) + " - " + toDisplayString(ticket.value.title || ticket.value.subject), 1),
                      createVNode("p", { class: "text-sm text-muted-500" }, toDisplayString(ticket.value.status) + " • " + toDisplayString(formatDate(ticket.value.created_at)), 1)
                    ]),
                    createVNode("div", { class: "text-sm text-muted-500" }, "Ticket provided by system")
                  ])) : (openBlock(), createBlock("div", {
                    key: 2,
                    class: "text-sm text-red-600"
                  }, "Ticket information not available."))
                ]),
                createVNode("div", null, [
                  createVNode("p", { class: "text-sm font-semibold text-gray-700 mb-2" }, "Ratings"),
                  createVNode("div", { class: "grid gap-4 sm:grid-cols-3" }, [
                    createVNode(Ratings, {
                      label: "Satisfaction",
                      modelValue: form.value.satisfaction_rating,
                      "onUpdate:modelValue": ($event) => form.value.satisfaction_rating = $event
                    }, null, 8, ["modelValue", "onUpdate:modelValue"]),
                    createVNode(Ratings, {
                      label: "Response time",
                      modelValue: form.value.response_time_rating,
                      "onUpdate:modelValue": ($event) => form.value.response_time_rating = $event
                    }, null, 8, ["modelValue", "onUpdate:modelValue"]),
                    createVNode(Ratings, {
                      label: "Resolution quality",
                      modelValue: form.value.resolution_quality_rating,
                      "onUpdate:modelValue": ($event) => form.value.resolution_quality_rating = $event
                    }, null, 8, ["modelValue", "onUpdate:modelValue"])
                  ])
                ]),
                createVNode(Comments, {
                  modelValue: form.value.comments,
                  "onUpdate:modelValue": ($event) => form.value.comments = $event,
                  maxLength: 1e3
                }, null, 8, ["modelValue", "onUpdate:modelValue"]),
                createVNode("div", null, [
                  errors.value.form ? (openBlock(), createBlock("div", {
                    key: 0,
                    class: "text-sm text-red-600 mb-2"
                  }, toDisplayString(errors.value.form), 1)) : createCommentVNode("", true),
                  createVNode(SubmitButtons, {
                    loading: submitting.value,
                    onSubmit: submit,
                    onCancel: ($event) => _ctx.$router.back()
                  }, null, 8, ["loading", "onCancel"])
                ])
              ], 32)
            ];
          }
        }),
        _: 1
      }, _parent));
      _push(`</div>`);
    };
  }
});
const _sfc_setup$1 = _sfc_main$1.setup;
_sfc_main$1.setup = (props, ctx) => {
  const ssrContext = useSSRContext();
  (ssrContext.modules || (ssrContext.modules = /* @__PURE__ */ new Set())).add("components/survey/SurveyForm.vue");
  return _sfc_setup$1 ? _sfc_setup$1(props, ctx) : void 0;
};
const SurveyForm = Object.assign(_sfc_main$1, { __name: "SurveyForm" });
const _sfc_main = /* @__PURE__ */ defineComponent({
  __name: "[id]",
  __ssrInlineRender: true,
  setup(__props) {
    return (_ctx, _push, _parent, _attrs) => {
      const _component_UDashboardGroup = _sfc_main$e;
      const _component_Sidebar = __nuxt_component_1;
      const _component_UDashboardPage = resolveComponent("UDashboardPage");
      const _component_Navbar = __nuxt_component_2;
      _push(ssrRenderComponent(_component_UDashboardGroup, _attrs, {
        default: withCtx((_, _push2, _parent2, _scopeId) => {
          if (_push2) {
            _push2(ssrRenderComponent(_component_Sidebar, null, null, _parent2, _scopeId));
            _push2(ssrRenderComponent(_component_UDashboardPage, { class: "flex flex-col flex-1 min-w-0 overflow-hidden" }, {
              default: withCtx((_2, _push3, _parent3, _scopeId2) => {
                if (_push3) {
                  _push3(ssrRenderComponent(_component_Navbar, {
                    title: "Survey",
                    icon: "i-lucide-clipboard-list",
                    class: "w-full"
                  }, null, _parent3, _scopeId2));
                  _push3(`<div class="flex flex-col flex-1 gap-6 p-6 overflow-auto"${_scopeId2}>`);
                  _push3(ssrRenderComponent(SurveyForm, null, null, _parent3, _scopeId2));
                  _push3(`</div>`);
                } else {
                  return [
                    createVNode(_component_Navbar, {
                      title: "Survey",
                      icon: "i-lucide-clipboard-list",
                      class: "w-full"
                    }),
                    createVNode("div", { class: "flex flex-col flex-1 gap-6 p-6 overflow-auto" }, [
                      createVNode(SurveyForm)
                    ])
                  ];
                }
              }),
              _: 1
            }, _parent2, _scopeId));
          } else {
            return [
              createVNode(_component_Sidebar),
              createVNode(_component_UDashboardPage, { class: "flex flex-col flex-1 min-w-0 overflow-hidden" }, {
                default: withCtx(() => [
                  createVNode(_component_Navbar, {
                    title: "Survey",
                    icon: "i-lucide-clipboard-list",
                    class: "w-full"
                  }),
                  createVNode("div", { class: "flex flex-col flex-1 gap-6 p-6 overflow-auto" }, [
                    createVNode(SurveyForm)
                  ])
                ]),
                _: 1
              })
            ];
          }
        }),
        _: 1
      }, _parent));
    };
  }
});
const _sfc_setup = _sfc_main.setup;
_sfc_main.setup = (props, ctx) => {
  const ssrContext = useSSRContext();
  (ssrContext.modules || (ssrContext.modules = /* @__PURE__ */ new Set())).add("pages/user/survey/[id].vue");
  return _sfc_setup ? _sfc_setup(props, ctx) : void 0;
};

export { _sfc_main as default };
//# sourceMappingURL=_id_-CwMs7EN4.mjs.map
