import{c as j,_ as q,a as O,b as L}from"./Ddr_hDuZ.js";import{_ as D}from"./RuDiqTgZ.js";import{g as x,c as d,o as u,a as t,t as _,F,q as I,L as P,b as i,v as $,w as y,d as V,p as B,a3 as z,a4 as G,z as b,h as M,Y as A,k as E,a2 as J}from"./BGim2kwq.js";import{g as Y}from"./B6rNHc4N.js";import{a0 as H}from"./GPD3P-m0.js";import"./kDLvYEi9.js";import"./K8s1tnq0.js";const K={class:"text-sm font-semibold text-gray-700 mb-1"},Q={class:"flex gap-3"},W=["onClick","aria-pressed"],X={class:"text-lg font-semibold"},Z={class:"text-xs text-muted-500"},ee=x({__name:"Ratings",props:{label:{type:String,default:""},modelValue:{type:Number,default:5}},emits:["update:modelValue"],setup(n,{emit:f}){const m=f,s=["Poor","Fair","Good","Very Good","Excellent"],a=r=>m("update:modelValue",r);return(r,p)=>(u(),d("div",null,[t("p",K,_(n.label),1),t("div",Q,[(u(),d(F,null,I(5,v=>t("button",{key:v,type:"button",onClick:o=>a(v),"aria-pressed":n.modelValue===v,class:P(["w-24 h-12 flex flex-col items-center justify-center rounded-md text-sm font-medium transition-colors",n.modelValue===v?"border border-sky-600 bg-sky-50 text-sky-700":"border border-transparent bg-white text-gray-800 hover:border-gray-200"])},[t("span",X,_(v),1),t("span",Z,_(s[v-1]),1)],10,W)),64))])]))}}),S=Object.assign(ee,{__name:"SurveyRatings"}),te=["value"],se={class:"text-xs text-muted-500 mt-1"},ae=x({__name:"Comments",props:{modelValue:{type:String,default:""},maxLength:{type:Number,default:1e3}},emits:["update:modelValue"],setup(n,{emit:f}){const m=n,s=f,a=r=>{const p=String(r.target.value).slice(0,m.maxLength);s("update:modelValue",p)};return(r,p)=>(u(),d("div",null,[p[0]||(p[0]=t("label",{class:"text-sm font-semibold text-gray-700"},"Comments (optional)",-1)),t("textarea",{value:n.modelValue,onInput:a,rows:4,class:"form-textarea w-full mt-1",placeholder:"Anything else you'd like to tell us?"},null,40,te),t("div",se,"Optional — helpful for context (max "+_(n.maxLength)+" chars).",1)]))}}),oe=Object.assign(ae,{__name:"SurveyComments"}),ne={class:"flex items-center gap-3"},le=x({__name:"SubmitButtons",props:{loading:{type:Boolean,default:!1}},emits:["submit","cancel"],setup(n,{emit:f}){return(m,s)=>{const a=H;return u(),d("div",ne,[i(a,{loading:n.loading,color:"primary",onClick:s[0]||(s[0]=$(r=>m.$emit("submit"),["prevent"]))},{default:y(()=>[...s[2]||(s[2]=[V("Submit feedback",-1)])]),_:1},8,["loading"]),i(a,{color:"neutral",variant:"outline",onClick:s[1]||(s[1]=$(r=>m.$emit("cancel"),["prevent"]))},{default:y(()=>[...s[3]||(s[3]=[V("Cancel",-1)])]),_:1})])}}}),ie=Object.assign(le,{__name:"SurveySubmitButtons"}),re={key:0,class:"my-2"},ue=x({__name:"SuccessBanner",props:{message:{type:String,default:""}},setup(n){return(f,m)=>{const s=j;return n.message?(u(),d("div",re,[i(s,{color:"emerald",variant:"soft"},{default:y(()=>[V(_(n.message),1)]),_:1})])):B("",!0)}}}),me=Object.assign(ue,{__name:"SurveySuccessBanner"}),ce={class:"space-y-6"},de={class:"flex items-center justify-between"},_e={key:0,class:"py-4"},fe={key:1,class:"flex items-center justify-between"},pe={class:"text-base font-semibold"},ve={class:"text-sm text-muted-500"},ge={key:2,class:"text-sm text-red-600"},be={class:"grid gap-4 sm:grid-cols-3"},ye={key:0,class:"text-sm text-red-600 mb-2"},xe=x({__name:"SurveyForm",setup(n){const f=z(),m=G(),s=f.params.id||"",a=b(null),r=b(!1);M(async()=>{if(s){r.value=!0;try{a.value=await Y(s)}catch{a.value=null}finally{r.value=!1}}});const v=l=>{if(!l)return"";const e=new Date(l);return Number.isNaN(e.getTime())?String(l):e.toLocaleString()},o=b({ticket_id:s||"",satisfaction_rating:5,response_time_rating:5,resolution_quality_rating:5,comments:""}),g=b({}),k=b(!1),w=b(""),T=()=>{g.value={};const l=e=>Number(e)>=1&&Number(e)<=5;return l(o.value.satisfaction_rating)||(g.value.satisfaction_rating="Required (1-5)"),l(o.value.response_time_rating)||(g.value.response_time_rating="Required (1-5)"),l(o.value.resolution_quality_rating)||(g.value.resolution_quality_rating="Required (1-5)"),Object.keys(g.value).length===0},C=async()=>{if(T()){k.value=!0;try{let e=A("auth_token").value||"";try{e=decodeURIComponent(e)}catch{}const h={satisfaction_rating:Number(o.value.satisfaction_rating),response_time_rating:Number(o.value.response_time_rating),resolution_quality_rating:Number(o.value.resolution_quality_rating),comments:o.value.comments},c=a.value?.id||o.value.ticket_id||s,R=`http://localhost:8000/api/tickets/${encodeURIComponent(c)}/survey`,N=await fetch(R,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(h)}),U=await N.json();if(!N.ok)throw U;w.value="Thank you — your feedback has been submitted.",setTimeout(()=>m.push("/user/tickets"),1400)}catch(l){console.error("submit survey",l),g.value.form=l?.message||"Submission failed"}finally{k.value=!1}}};return(l,e)=>{const h=D;return u(),d("div",ce,[t("div",de,[e[5]||(e[5]=t("div",null,[t("p",{class:"text-sm text-muted-500"},"User"),t("h2",{class:"text-lg font-semibold text-gray-900"},"Ticket Survey"),t("p",{class:"text-sm text-muted-500"},"Please provide feedback for the selected ticket.")],-1)),i(me,{message:w.value},null,8,["message"])]),i(h,null,{default:y(()=>[t("form",{onSubmit:$(C,["prevent"]),class:"space-y-6"},[t("div",null,[r.value?(u(),d("div",_e,"Loading ticket...")):a.value?(u(),d("div",fe,[t("div",null,[e[6]||(e[6]=t("p",{class:"text-sm text-muted-500"},"Ticket",-1)),t("p",pe,_(a.value.id)+" - "+_(a.value.title||a.value.subject),1),t("p",ve,_(a.value.status)+" • "+_(v(a.value.created_at)),1)]),e[7]||(e[7]=t("div",{class:"text-sm text-muted-500"},"Ticket provided by system",-1))])):(u(),d("div",ge,"Ticket information not available."))]),t("div",null,[e[8]||(e[8]=t("p",{class:"text-sm font-semibold text-gray-700 mb-2"},"Ratings",-1)),t("div",be,[i(S,{label:"Satisfaction",modelValue:o.value.satisfaction_rating,"onUpdate:modelValue":e[0]||(e[0]=c=>o.value.satisfaction_rating=c)},null,8,["modelValue"]),i(S,{label:"Response time",modelValue:o.value.response_time_rating,"onUpdate:modelValue":e[1]||(e[1]=c=>o.value.response_time_rating=c)},null,8,["modelValue"]),i(S,{label:"Resolution quality",modelValue:o.value.resolution_quality_rating,"onUpdate:modelValue":e[2]||(e[2]=c=>o.value.resolution_quality_rating=c)},null,8,["modelValue"])])]),i(oe,{modelValue:o.value.comments,"onUpdate:modelValue":e[3]||(e[3]=c=>o.value.comments=c),maxLength:1e3},null,8,["modelValue"]),t("div",null,[g.value.form?(u(),d("div",ye,_(g.value.form),1)):B("",!0),i(ie,{loading:k.value,onSubmit:C,onCancel:e[4]||(e[4]=c=>l.$router.back())},null,8,["loading"])])],32)]),_:1})])}}}),ke=Object.assign(xe,{__name:"SurveyForm"}),he={class:"flex flex-col flex-1 gap-6 p-6 overflow-auto"},Te=x({__name:"[id]",setup(n){return(f,m)=>{const s=O,a=L,r=J("UDashboardPage"),p=q;return u(),E(p,null,{default:y(()=>[i(s),i(r,{class:"flex flex-col flex-1 min-w-0 overflow-hidden"},{default:y(()=>[i(a,{title:"Survey",icon:"i-lucide-clipboard-list",class:"w-full"}),t("div",he,[i(ke)])]),_:1})]),_:1})}}});export{Te as default};
