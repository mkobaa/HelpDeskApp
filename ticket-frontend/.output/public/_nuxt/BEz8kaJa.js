import{s as J,_ as K,a as Q,b as X,c as Y}from"./Ddr_hDuZ.js";import{a0 as Z}from"./GPD3P-m0.js";import{_ as tt}from"./CFZJElYW.js";import{_ as et}from"./RuDiqTgZ.js";import{_ as st,u as at}from"./qEMXtAZA.js";import{_ as ot}from"./3Xv3klxV.js";import{g as nt}from"./B6rNHc4N.js";import{g as it,a3 as rt,e as k,z as C,P as lt,$ as ct,h as dt,j as ut,a5 as pt,a1 as mt,k as F,w as u,a2 as D,o as p,b as i,a as e,p as V,f as o,d as f,t as r,c as _,F as I,q as _t}from"./BGim2kwq.js";import{u as xt}from"./RmwAmyau.js";import"./kDLvYEi9.js";import"./K8s1tnq0.js";import"./CCraGg39.js";import"./D3QffkNq.js";const ht={class:"flex flex-col flex-1 gap-6 p-6 overflow-auto"},vt={class:"flex items-center justify-between gap-3"},yt={class:"flex gap-2"},ft={class:"space-y-1"},gt={class:"text-base font-medium text-gray-900"},bt={class:"space-y-1"},kt={class:"space-y-1"},wt={class:"text-base text-gray-900 font-mono"},$t={class:"space-y-1"},Tt={class:"text-base text-gray-900"},Ut={class:"space-y-1"},Ct={class:"text-base text-gray-900"},Dt={class:"space-y-1"},It={class:"text-base text-gray-900"},St={class:"space-y-1 sm:col-span-2"},Nt={class:"text-base text-gray-900 whitespace-pre-line"},Pt={key:0,class:"space-y-1 sm:col-span-2"},Bt={class:"flex flex-wrap gap-4"},Wt=["src","alt"],jt=["src"],Ft={key:2,class:"i-lucide-file text-3xl text-gray-400 mb-2"},Vt=["href"],At={class:"space-y-1"},Et={class:"text-base font-medium text-gray-900"},Mt={class:"text-base text-gray-900"},Gt={class:"text-base text-gray-900"},zt={class:"space-y-1"},Ht={class:"text-base text-gray-900"},Rt={class:"space-y-1 sm:col-span-2"},qt={class:"text-base text-gray-900 whitespace-pre-line"},Lt={class:"sm:col-span-2 flex justify-end gap-3 pt-2"},re=it({__name:"[id]",async setup(Ot){let g,S;const A=rt(),v=k(()=>A.params.id),m=C(!1),y=C(!1),l=lt({status:"",priority:"",technicianId:""}),E=["open","in_progress","pending","resolved","closed"],{data:s,status:M,refresh:N,error:P}=([g,S]=ct(()=>xt(()=>nt(v.value),{watch:[v],server:!1},"$9dGDsD_3P5")),g=await g,S(),g);k(()=>(users.value||[]).map(a=>({label:a.username||a.email||`Tech #${a.id}`,value:String(a.id)})));const G=a=>{const t=a?.url||a?.path||a?.file_path||a?.attachment_url||a?.location;if(!t)return"";if(/^https?:\/\//i.test(t))return t;const c=window.location.origin.replace(/\/+$/,""),d=String(t).replace(/^\/+/,"");return d.startsWith("storage/")?`${c}/${d}`:d.startsWith("attachments/")?`${c}/storage/${d}`:d.startsWith("storage\\")?`${c}/${d.replace("\\","/")}`:`${c}/${d}`},B=k(()=>(s.value?.attachments||s.value?.files||s.value?.attachments?.data||s.value?.media||s.value?.documents||[]||[]).map(t=>({url:G(t),name:t?.name||t?.filename||t?.original_name||t?.file_name||t?.display_name||t?.path||t?.url||"File",type:t?.mime_type||t?.type||""})).filter(t=>t.url));k(()=>{if(!s.value)return null;const a=s.value.assigned_tech_id||s.value.technician_id;return a?(users.value||[]).find(t=>t.id==a):null});const w=C("");let $=null;const W=()=>{if(!s.value?.created_at)return;const a=new Date(s.value.created_at).getTime(),c=new Date().getTime()-a;if(c<0){w.value="0s";return}const d=Math.floor(c/(1e3*60*60*24)),b=Math.floor(c%(1e3*60*60*24)/(1e3*60*60)),x=Math.floor(c%(1e3*60*60)/(1e3*60)),T=Math.floor(c%(1e3*60)/1e3),h=[];d>0&&h.push(`${d}d`),b>0&&h.push(`${b}h`),x>0&&h.push(`${x}m`),h.push(`${T}s`),w.value=h.join(" ")};dt(()=>{W(),$=J(W,1e3)}),ut(()=>{$&&clearInterval($)}),pt(()=>{if(s.value){l.status=s.value.status||"",l.priority=s.value.priority||"";const a=s.value.assigned_tech_id||s.value.technician_id||s.value.technicianId||s.value.technician?.id;l.technicianId=a?String(a):""}});const j=()=>{if(m.value=!m.value,!m.value&&s.value){l.status=s.value.status||"",l.priority=s.value.priority||"";const a=s.value.assigned_tech_id||s.value.technician_id||s.value.technicianId||s.value.technician?.id;l.technicianId=a?String(a):""}},z=async()=>{if(!(y.value||!v.value)){y.value=!0;try{const a={status:l.status||void 0,priority:l.priority||void 0,assigned_tech_id:l.technicianId?Number(l.technicianId):void 0};await at(v.value,l.status),await N(),m.value=!1}catch(a){console.error("Failed to update ticket",a)}finally{y.value=!1}}};return mt(()=>{N()}),(a,t)=>{const c=Q,d=X,b=D("UDashboardPageHeader"),x=Z,T=Y,h=tt,U=D("UFormGroup"),H=et,R=st,q=ot,L=D("UDashboardPage"),O=K;return p(),F(O,null,{default:u(()=>[i(c),i(L,{class:"flex flex-col flex-1 min-w-0 overflow-hidden"},{default:u(()=>[i(d,{title:"Ticket",icon:"i-lucide-ticket",class:"w-full"}),e("div",ht,[e("div",vt,[i(b,{title:o(s)?`Ticket #${o(s).id}`:"Ticket",description:o(s)?.title||"Ticket details"},null,8,["title","description"]),e("div",yt,[i(x,{size:"sm",icon:o(m)?"i-lucide-x":"i-lucide-pencil",color:o(m)?"neutral":"primary",onClick:j},{default:u(()=>[f(r(o(m)?"Cancel":"Edit"),1)]),_:1},8,["icon","color"]),i(x,{color:"neutral",variant:"ghost",icon:"i-lucide-arrow-left",to:"/supervisor/tickets"},{default:u(()=>[...t[1]||(t[1]=[f(" Back ",-1)])]),_:1})])]),i(H,{ui:{body:"grid gap-4 sm:grid-cols-2"},loading:o(M)==="pending"},{default:u(()=>[o(m)?(p(),_(I,{key:1},[e("div",At,[t[10]||(t[10]=e("p",{class:"text-xs text-muted-500"},"Title",-1)),e("p",Et,r(o(s)?.title||"-"),1)]),i(U,{label:"Status",name:"status"},{default:u(()=>[i(h,{modelValue:o(l).status,"onUpdate:modelValue":t[0]||(t[0]=n=>o(l).status=n),items:E,placeholder:"Select status"},null,8,["modelValue"])]),_:1}),i(U,{label:"Priority",name:"priority"},{default:u(()=>[e("p",Mt,r(o(s)?.priority||"-"),1)]),_:1}),i(U,{label:"Assign technician",name:"technician"},{default:u(()=>[e("p",Gt,r(a.technicianDisplayName),1)]),_:1}),e("div",zt,[t[11]||(t[11]=e("p",{class:"text-xs text-muted-500"},"Category",-1)),e("p",Ht,r(o(s)?.category?.name||"-"),1)]),e("div",Rt,[t[12]||(t[12]=e("p",{class:"text-xs text-muted-500"},"Description",-1)),e("p",qt,r(o(s)?.description||"-"),1)]),e("div",Lt,[i(x,{type:"button",color:"neutral",variant:"ghost",onClick:j},{default:u(()=>[...t[13]||(t[13]=[f("Cancel",-1)])]),_:1}),i(x,{type:"button",color:"primary",icon:"i-lucide-check",loading:o(y),disabled:o(y),onClick:z},{default:u(()=>[...t[14]||(t[14]=[f(" Save Changes ",-1)])]),_:1},8,["loading","disabled"])])],64)):(p(),_(I,{key:0},[e("div",ft,[t[2]||(t[2]=e("p",{class:"text-xs text-muted-500"},"Title",-1)),e("p",gt,r(o(s)?.title||"-"),1)]),e("div",bt,[t[3]||(t[3]=e("p",{class:"text-xs text-muted-500"},"Status",-1)),i(T,{color:"primary",variant:"soft"},{default:u(()=>[f(r(o(s)?.status||"-"),1)]),_:1})]),e("div",kt,[t[4]||(t[4]=e("p",{class:"text-xs text-muted-500"},"Time Elapsed",-1)),e("p",wt,r(o(w)),1)]),e("div",$t,[t[5]||(t[5]=e("p",{class:"text-xs text-muted-500"},"Priority",-1)),e("p",Tt,r(o(s)?.priority||"-"),1)]),e("div",Ut,[t[6]||(t[6]=e("p",{class:"text-xs text-muted-500"},"Technician",-1)),e("p",Ct,r(a.technicianDisplayName),1)]),e("div",Dt,[t[7]||(t[7]=e("p",{class:"text-xs text-muted-500"},"Category",-1)),e("p",It,r(o(s)?.category?.name||"-"),1)]),e("div",St,[t[8]||(t[8]=e("p",{class:"text-xs text-muted-500"},"Description",-1)),e("p",Nt,r(o(s)?.description||"-"),1)]),o(B).length?(p(),_("div",Pt,[t[9]||(t[9]=e("p",{class:"text-xs text-muted-500"},"Attachments",-1)),e("div",Bt,[(p(!0),_(I,null,_t(o(B),n=>(p(),_("div",{key:n.url||n.name,class:"flex flex-col items-center w-32"},[n.url&&(n.url.endsWith(".png")||n.url.endsWith(".jpg")||n.url.endsWith(".jpeg")||n.url.endsWith(".gif"))?(p(),_("img",{key:0,src:n.url,alt:n.name,class:"w-28 h-28 object-cover rounded border"},null,8,Wt)):n.url&&n.url.endsWith(".pdf")?(p(),_("embed",{key:1,src:n.url,type:"application/pdf",class:"w-28 h-28 border rounded"},null,8,jt)):(p(),_("span",Ft)),e("a",{href:n.url,target:"_blank",class:"text-xs text-primary underline mt-1 break-all"},r(n.name||n.url),9,Vt)]))),128))])])):V("",!0)],64))]),_:1},8,["loading"]),i(R,{"ticket-id":o(v)},null,8,["ticket-id"]),o(P)?(p(),F(q,{key:0,icon:"i-lucide-alert-triangle",color:"red",variant:"soft",title:"Unable to load ticket",description:o(P)?.message||"Please try again."},null,8,["description"])):V("",!0)])]),_:1})]),_:1})}}});export{re as default};
